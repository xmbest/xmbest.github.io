<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>记一次android-10.0.0_r41编译</title>
      <link href="/2024/09/15/%E8%AE%B0%E4%B8%80%E6%AC%A1android-10.0.0_r41%E7%BC%96%E8%AF%91/"/>
      <url>/2024/09/15/%E8%AE%B0%E4%B8%80%E6%AC%A1android-10.0.0_r41%E7%BC%96%E8%AF%91/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ubuntu版本: 18.04.6 </p></blockquote><p>参考资料: </p><ul><li><a href="https://source.android.google.cn/?hl=zh-cn">AOSP</a></li><li><a href="https://mirrors.tuna.tsinghua.edu.cn/">清华大学开源软件镜像站</a></li><li><a href="https://www.bilibili.com/video/BV1y84y1k7be">【阳光沙滩】Android Open Source Project入门课程</a></li><li><a href="https://blog.csdn.net/qq_34330286/article/details/137440618">【AOSP】手把手教你编译和调试AOSP源码</a></li><li><a href="https://blog.csdn.net/amosstan/article/details/122077634">Android10.0编译 make api-stubs-docs-update-current-api问题</a></li></ul><h4 id="1-安装必需的软件包-AOSP-9-0-或更高版本"><a href="#1-安装必需的软件包-AOSP-9-0-或更高版本" class="headerlink" title="1.安装必需的软件包 AOSP 9.0 或更高版本"></a>1.安装必需的软件包 <a href="https://source.android.google.cn/docs/setup/start/requirements?hl=zh-cn">AOSP 9.0 或更高版本</a></h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt-get install git-core gnupg flex bison build-essential zip curl zlib1g-dev libc6-dev-i386 x11proto-core-dev libx11-dev lib32z1-dev libgl1-mesa-dev libxml2-utils xsltproc unzip fontconfig</span><br></pre></td></tr></table></figure><h4 id="2-安装必需的软件-清华大学开源软件镜像站"><a href="#2-安装必需的软件-清华大学开源软件镜像站" class="headerlink" title="2.安装必需的软件 清华大学开源软件镜像站"></a>2.安装必需的软件 <a href="https://mirrors.tuna.tsinghua.edu.cn/">清华大学开源软件镜像站</a></h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt-get update</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 repo 工具</span></span><br><span class="line"><span class="built_in">mkdir</span> ~/bin</span><br><span class="line">curl https://mirrors.tuna.tsinghua.edu.cn/git/git-repo -o ~/bin/repo</span><br><span class="line"><span class="built_in">chmod</span> a+x ~/bin/repo</span><br><span class="line"><span class="comment"># 配置环境变量</span></span><br><span class="line">vim ~/.bashrc</span><br><span class="line"><span class="comment"># 添加一下内容</span></span><br><span class="line">PATH=<span class="variable">$PATH</span>:~/bin</span><br><span class="line"><span class="built_in">export</span> REPO_URL=<span class="string">&#x27;https://mirrors.tuna.tsinghua.edu.cn/git/git-repo&#x27;</span></span><br><span class="line"><span class="comment"># 保存退出执行以下命令</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure><h4 id="3-初始化并且同步代码-AOSP-开始开发"><a href="#3-初始化并且同步代码-AOSP-开始开发" class="headerlink" title="3.初始化并且同步代码 AOSP 开始开发"></a>3.初始化并且同步代码 <a href="https://source.android.google.cn/docs/setup/start?hl=zh-cn">AOSP 开始开发</a></h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line"><span class="built_in">mkdir</span> aosp</span><br><span class="line"><span class="built_in">cd</span> ~/aosp</span><br><span class="line"><span class="comment"># 初始化repo，指定源码分支为 `android-10.0.0_r41`</span></span><br><span class="line">repo init -u https://mirrors.tuna.tsinghua.edu.cn/git/AOSP/platform/manifest -b android-10.0.0_r41</span><br><span class="line"><span class="comment"># 配置git名称和邮箱</span></span><br><span class="line">git config --global user.name xx</span><br><span class="line">git config --global user.email xx@xx.xx</span><br><span class="line"><span class="comment"># 同步源代码,耗时较久</span></span><br><span class="line">repo <span class="built_in">sync</span> -j4</span><br></pre></td></tr></table></figure><h4 id="4-构建代码"><a href="#4-构建代码" class="headerlink" title="4.构建代码"></a>4.构建代码</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看处理器架构,我这边是x86_64</span></span><br><span class="line">xm@ubuntu:~$ arch</span><br><span class="line">x86_64</span><br><span class="line"></span><br><span class="line">cd ~/aosp</span><br><span class="line">source build/envsetup.sh</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输入lunch aosp_x86_64-eng(aosp_<span class="variable">$arch</span>-eng) 或直接输入lunch 键入数字选择，如下输入26</span></span><br><span class="line">xm@ubuntu:~/aosp$ lunch</span><br><span class="line"></span><br><span class="line">You&#x27;re building on Linux</span><br><span class="line"></span><br><span class="line">Lunch menu... pick a combo:</span><br><span class="line">     1. aosp_arm-eng</span><br><span class="line">     2. aosp_arm64-eng</span><br><span class="line">     3. aosp_blueline-userdebug</span><br><span class="line">     4. aosp_bonito-userdebug</span><br><span class="line">     5. aosp_car_arm-userdebug</span><br><span class="line">     6. aosp_car_arm64-userdebug</span><br><span class="line">     7. aosp_car_x86-userdebug</span><br><span class="line">     8. aosp_car_x86_64-userdebug</span><br><span class="line">     9. aosp_cf_arm64_phone-userdebug</span><br><span class="line">     10. aosp_cf_x86_64_phone-userdebug</span><br><span class="line">     11. aosp_cf_x86_auto-userdebug</span><br><span class="line">     12. aosp_cf_x86_phone-userdebug</span><br><span class="line">     13. aosp_cf_x86_tv-userdebug</span><br><span class="line">     14. aosp_coral-userdebug</span><br><span class="line">     15. aosp_coral_car-userdebug</span><br><span class="line">     16. aosp_crosshatch-userdebug</span><br><span class="line">     17. aosp_crosshatch_car-userdebug</span><br><span class="line">     18. aosp_flame-userdebug</span><br><span class="line">     19. aosp_marlin-userdebug</span><br><span class="line">     20. aosp_sailfish-userdebug</span><br><span class="line">     21. aosp_sargo-userdebug</span><br><span class="line">     22. aosp_taimen-userdebug</span><br><span class="line">     23. aosp_walleye-userdebug</span><br><span class="line">     24. aosp_walleye_test-userdebug</span><br><span class="line">     25. aosp_x86-eng</span><br><span class="line">     26. aosp_x86_64-eng</span><br><span class="line">     27. beagle_x15-userdebug</span><br><span class="line">     28. car_x86_64-userdebug</span><br><span class="line">     29. fuchsia_arm64-eng</span><br><span class="line">     30. fuchsia_x86_64-eng</span><br><span class="line">     31. hikey-userdebug</span><br><span class="line">     32. hikey64_only-userdebug</span><br><span class="line">     33. hikey960-userdebug</span><br><span class="line">     34. hikey960_tv-userdebug</span><br><span class="line">     35. hikey_tv-userdebug</span><br><span class="line">     36. m_e_arm-userdebug</span><br><span class="line">     37. mini_emulator_arm64-userdebug</span><br><span class="line">     38. mini_emulator_x86-userdebug</span><br><span class="line">     39. mini_emulator_x86_64-userdebug</span><br><span class="line">     40. poplar-eng</span><br><span class="line">     41. poplar-user</span><br><span class="line">     42. poplar-userdebug</span><br><span class="line">     43. qemu_trusty_arm64-userdebug</span><br><span class="line">     44. uml-userdebug</span><br><span class="line"></span><br><span class="line">Which would you like? [aosp_arm-eng] 26</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">使用make -j&lt;number&gt; 命令进行指定线程数编译，也可以使用 m 命令自动选择最大线程数，我这个虚拟机分配了4处理器4核心</span></span><br><span class="line">make -j12</span><br></pre></td></tr></table></figure><h4 id="5-虚拟机运行系统（需要开启硬件加速）"><a href="#5-虚拟机运行系统（需要开启硬件加速）" class="headerlink" title="5.虚拟机运行系统（需要开启硬件加速）"></a>5.虚拟机运行系统（需要开启硬件加速）</h4><blockquote><p>打开虚拟机中的硬件加速功能 虚拟机-&gt;设置-&gt;处理器-&gt;虚拟化引擎-&gt;虚拟化Intel VT-X&#x2F;EPT或AMD-V&#x2F;RVI (需要关机后设置)</p><p><a href="https://developer.android.com/studio/run/emulator-acceleration?hl=zh-cn#vm-linux">在 Linux 上配置虚拟机加速</a></p><p><a href="https://www.sunofbeach.net/a/1244130485534273536">阳光沙滩 KVM设置</a></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编译完成后通过emulator在模拟器中启动</span></span><br><span class="line">cd ~/aosp</span><br><span class="line">emulator</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">找不到emulator命令再重复执行以下命令后执行 1. sourch build/envsetup.sh  2. lunch</span></span><br></pre></td></tr></table></figure><h3 id="编译遇到的问题"><a href="#编译遇到的问题" class="headerlink" title="编译遇到的问题"></a>编译遇到的问题</h3><h4 id="1-编译使用了m-命令自动选择最大线程数"><a href="#1-编译使用了m-命令自动选择最大线程数" class="headerlink" title="1.编译使用了m 命令自动选择最大线程数"></a>1.编译使用了m 命令自动选择最大线程数</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">xm@ubuntu:~/aosp$ m</span><br><span class="line"></span><br><span class="line">FAILED: //frameworks/base:api-stubs-docs Metalava Check API [common]</span><br><span class="line">Outputs: out/soong/.intermediates/frameworks/base/api-stubs-docs/android_common/check_last_released_api.timestamp out/soong/.intermediates/frameworks/base/api-stubs-docs/android_common/last_released_baseline.txt</span><br><span class="line">Error: exited with code: 1</span><br><span class="line">******************************</span><br><span class="line">You have tried to change the API from what has been previously approved.</span><br><span class="line"></span><br><span class="line">To make these errors go away, you have two choices:</span><br><span class="line">   1. You can add <span class="string">&#x27;@hide&#x27;</span> javadoc comments to the methods, etc. listed <span class="keyword">in</span> the</span><br><span class="line">      errors above.</span><br><span class="line"></span><br><span class="line">   2. You can update current.txt by executing the following <span class="built_in">command</span>:</span><br><span class="line">         make test-api-stubs-docs-update-current-api</span><br><span class="line"></span><br><span class="line">      To submit the revised current.txt to the main Android repository,</span><br><span class="line">      you will need approval.</span><br><span class="line">******************************</span><br></pre></td></tr></table></figure><h4 id="1-处理方式：降低编译线程，调整交换分区，参考Android10-0编译-make-api-stubs-docs-update-current-api问题"><a href="#1-处理方式：降低编译线程，调整交换分区，参考Android10-0编译-make-api-stubs-docs-update-current-api问题" class="headerlink" title="1.处理方式：降低编译线程，调整交换分区，参考Android10.0编译 make api-stubs-docs-update-current-api问题"></a>1.处理方式：降低编译线程，调整交换分区，参考<a href="https://blog.csdn.net/amosstan/article/details/122077634">Android10.0编译 make api-stubs-docs-update-current-api问题</a></h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make -j12</span><br></pre></td></tr></table></figure><h4 id="2-print-“‘-s’-cannot-be-converted-to-int”-line-2"><a href="#2-print-“‘-s’-cannot-be-converted-to-int”-line-2" class="headerlink" title="2. print “‘%s’ cannot be converted to int” % (line[2])"></a>2. print “‘%s’ cannot be converted to int” % (line[2])</h4><blockquote><p>File “device&#x2F;generic&#x2F;goldfish&#x2F;tools&#x2F;mk_combined_img.py”, line 48<br>    print “‘%s’ cannot be converted to int” % (line[2])</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python 版本不对</span></span><br><span class="line"><span class="built_in">sudo</span> apt install python</span><br></pre></td></tr></table></figure><h4 id="3-emulator打开失败"><a href="#3-emulator打开失败" class="headerlink" title="3.emulator打开失败"></a>3.emulator打开失败</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">emulator </span><br><span class="line">emulator: WARNING: Couldn&#x27;t find crash service executable /home/xm/aosp/prebuilts/android-emulator/linux-x86_64/emulator64-crash-service</span><br><span class="line"></span><br><span class="line">emulator: WARNING: system partition size adjusted to match image file (3083 MB &gt; 800 MB)</span><br><span class="line"></span><br><span class="line">Warning: could not connect to display  ((null):0, (null))</span><br><span class="line">INFO: QtLogger.cpp:66: Warning: could not connect to display  ((null):0, (null))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INFO: QtLogger.cpp:66: Info: Could not load the Qt platform plugin &quot;xcb&quot; in &quot;/home/xm/aosp/prebuilts/android-emulator/linux-x86_64/lib64/qt/plugins&quot; even though it was found. ((null):0, (null))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Fatal: This application failed to start because no Qt platform plugin could be initialized. Reinstalling the application may fix this problem.</span><br><span class="line"></span><br><span class="line">Available platform plugins are: xcb.</span><br><span class="line"> ((null):0, (null))</span><br><span class="line">INFO: QtLogger.cpp:66: Fatal: This application failed to start because no Qt platform plugin could be initialized. Reinstalling the application may fix this problem.</span><br><span class="line"></span><br><span class="line">Available platform plugins are: xcb.</span><br><span class="line"> ((null):0, (null))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">已放弃 (核心已转储)</span><br></pre></td></tr></table></figure><p>尝试增大partition size(依然错误)</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">emulator partition-size 4096</span><br><span class="line">emulator: WARNING: Couldn&#x27;t find crash service executable /home/xm/aosp/prebuilts/android-emulator/linux-x86_64/emulator64-crash-service</span><br><span class="line"></span><br><span class="line">emulator: WARNING: userdata partition is resized from 2048 M to 4096 M</span><br><span class="line"></span><br><span class="line">ERROR: resizing partition failed to launch /home/xm/aosp/prebuilts/android-emulator/linux-x86_64/bin64/resize2fs</span><br><span class="line">Warning: could not connect to display  ((null):0, (null))</span><br><span class="line">INFO: QtLogger.cpp:66: Warning: could not connect to display  ((null):0, (null))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INFO: QtLogger.cpp:66: Info: Could not load the Qt platform plugin &quot;xcb&quot; in &quot;/home/xm/aosp/prebuilts/android-emulator/linux-x86_64/lib64/qt/plugins&quot; even though it was found. ((null):0, (null))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Fatal: This application failed to start because no Qt platform plugin could be initialized. Reinstalling the application may fix this problem.</span><br><span class="line"></span><br><span class="line">Available platform plugins are: xcb.</span><br><span class="line"> ((null):0, (null))</span><br><span class="line">INFO: QtLogger.cpp:66: Fatal: This application failed to start because no Qt platform plugin could be initialized. Reinstalling the application may fix this problem.</span><br><span class="line"></span><br><span class="line">Available platform plugins are: xcb.</span><br><span class="line"> ((null):0, (null))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">已放弃 (核心已转储)</span><br></pre></td></tr></table></figure><h4 id="3-处理方式：打开虚拟机终端执行，以上是在ssh工具执行导致"><a href="#3-处理方式：打开虚拟机终端执行，以上是在ssh工具执行导致" class="headerlink" title="3.处理方式：打开虚拟机终端执行，以上是在ssh工具执行导致"></a>3.处理方式：打开虚拟机终端执行，以上是在ssh工具执行导致</h4>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
          <category> AOSP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Git </tag>
            
            <tag> Repo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>记一次原生AB分区OTA升级实现</title>
      <link href="/2024/07/12/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%8E%9F%E7%94%9FAB%E5%88%86%E5%8C%BAOTA%E5%8D%87%E7%BA%A7%E5%AE%9E%E7%8E%B0/"/>
      <url>/2024/07/12/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%8E%9F%E7%94%9FAB%E5%88%86%E5%8C%BAOTA%E5%8D%87%E7%BA%A7%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<blockquote><p>系统需要实现软件ota功能</p></blockquote><h4 id="具体代码实现"><a href="#具体代码实现" class="headerlink" title="具体代码实现"></a>具体代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UpdateEngine</span> <span class="variable">mUpdateEngine</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UpdateEngine</span>();</span><br><span class="line">UpdateParser.ParsedUpdate mParsedUpdate;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    mParsedUpdate = UpdateParser.parse(<span class="keyword">new</span> <span class="title class_">File</span>(Environment.getDataDirectory(), <span class="string">&quot;ota_package/update.zip&quot;</span>));</span><br><span class="line">    Log.d(TAG,<span class="string">&quot;mParsedUpdate = &quot;</span> + mParsedUpdate);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!mParsedUpdate.isValid())&#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">mUpdateEngine.bind(<span class="keyword">new</span> <span class="title class_">UpdateEngineCallback</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onStatusUpdate</span><span class="params">(<span class="type">int</span> status, <span class="type">float</span> percent)</span> &#123;</span><br><span class="line">        Log.d(TAG,<span class="string">&quot;onStatusUpdate status = &quot;</span> + status + <span class="string">&quot;,percent = &quot;</span> + percent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPayloadApplicationComplete</span><span class="params">(<span class="type">int</span> errorCode)</span> &#123;</span><br><span class="line">        Log.d(TAG,<span class="string">&quot;onPayloadApplicationComplete errorCode = &quot;</span> + errorCode);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">mUpdateEngine.applyPayload(mParsedUpdate.mUrl, mParsedUpdate.mOffset, mParsedUpdate.mSize, mParsedUpdate.mProps);</span><br></pre></td></tr></table></figure><h4 id="升级流程"><a href="#升级流程" class="headerlink" title="升级流程"></a>升级流程</h4><p>onStatusUpdate回调status变化值，状态码参考<a href="http://aospxref.com/android-13.0.0_r3/xref/frameworks/base/core/java/android/os/UpdateEngine.java">UpdateEngine</a> UpdateEngine#UpdateStatusConstants、UpdateEngine#ErrorCodeConstants </p><blockquote><p>IDLE(0)-UPDATE_AVAILABLE(2)-11-DOWNLOADING (3)-VERIFYING(4)-FINALIZING(5)-UPDATED_NEED_REBOOT(6)</p></blockquote><p><strong>UpdateStatusConstants</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">184       * Status codes for update engine. Values must agree with the ones in</span></span><br><span class="line"><span class="comment">185       * &#123;<span class="doctag">@code</span> system/update_engine/client_library/include/update_engine/update_status.h&#125;.</span></span><br><span class="line"><span class="comment">186       */</span></span><br><span class="line"><span class="number">187</span>      <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">UpdateStatusConstants</span> &#123;</span><br><span class="line"><span class="number">188</span>          <span class="comment">/**</span></span><br><span class="line"><span class="comment">189           * Update status code: update engine is in idle state.</span></span><br><span class="line"><span class="comment">190           */</span></span><br><span class="line"><span class="number">191</span>          <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">IDLE</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="number">192</span>  </span><br><span class="line"><span class="number">193</span>          <span class="comment">/**</span></span><br><span class="line"><span class="comment">194           * Update status code: update engine is checking for update.</span></span><br><span class="line"><span class="comment">195           */</span></span><br><span class="line"><span class="number">196</span>          <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">CHECKING_FOR_UPDATE</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="number">197</span>  </span><br><span class="line"><span class="number">198</span>          <span class="comment">/**</span></span><br><span class="line"><span class="comment">199           * Update status code: an update is available.</span></span><br><span class="line"><span class="comment">200           */</span></span><br><span class="line"><span class="number">201</span>          <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">UPDATE_AVAILABLE</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"><span class="number">202</span>  </span><br><span class="line"><span class="number">203</span>          <span class="comment">/**</span></span><br><span class="line"><span class="comment">204           * Update status code: update engine is downloading an update.</span></span><br><span class="line"><span class="comment">205           */</span></span><br><span class="line"><span class="number">206</span>          <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DOWNLOADING</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line"><span class="number">207</span>  </span><br><span class="line"><span class="number">208</span>          <span class="comment">/**</span></span><br><span class="line"><span class="comment">209           * Update status code: update engine is verifying an update.</span></span><br><span class="line"><span class="comment">210           */</span></span><br><span class="line"><span class="number">211</span>          <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">VERIFYING</span> <span class="operator">=</span> <span class="number">4</span>;</span><br><span class="line"><span class="number">212</span>  </span><br><span class="line"><span class="number">213</span>          <span class="comment">/**</span></span><br><span class="line"><span class="comment">214           * Update status code: update engine is finalizing an update.</span></span><br><span class="line"><span class="comment">215           */</span></span><br><span class="line"><span class="number">216</span>          <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">FINALIZING</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line"><span class="number">217</span>  </span><br><span class="line"><span class="number">218</span>          <span class="comment">/**</span></span><br><span class="line"><span class="comment">219           * Update status code: an update has been applied and is pending for</span></span><br><span class="line"><span class="comment">220           * reboot.</span></span><br><span class="line"><span class="comment">221           */</span></span><br><span class="line"><span class="number">222</span>          <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">UPDATED_NEED_REBOOT</span> <span class="operator">=</span> <span class="number">6</span>;</span><br><span class="line"><span class="number">223</span>  </span><br><span class="line"><span class="number">224</span>          <span class="comment">/**</span></span><br><span class="line"><span class="comment">225           * Update status code: update engine is reporting an error event.</span></span><br><span class="line"><span class="comment">226           */</span></span><br><span class="line"><span class="number">227</span>          <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">REPORTING_ERROR_EVENT</span> <span class="operator">=</span> <span class="number">7</span>;</span><br><span class="line"><span class="number">228</span>  </span><br><span class="line"><span class="number">229</span>          <span class="comment">/**</span></span><br><span class="line"><span class="comment">230           * Update status code: update engine is attempting to rollback an</span></span><br><span class="line"><span class="comment">231           * update.</span></span><br><span class="line"><span class="comment">232           */</span></span><br><span class="line"><span class="number">233</span>          <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ATTEMPTING_ROLLBACK</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line"><span class="number">234</span>  </span><br><span class="line"><span class="number">235</span>          <span class="comment">/**</span></span><br><span class="line"><span class="comment">236           * Update status code: update engine is in disabled state.</span></span><br><span class="line"><span class="comment">237           */</span></span><br><span class="line"><span class="number">238</span>          <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DISABLED</span> <span class="operator">=</span> <span class="number">9</span>;</span><br><span class="line"><span class="number">239</span>      &#125;</span><br></pre></td></tr></table></figure><p><strong>ErrorCodeConstants</strong> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">59       * Error codes from update engine upon finishing a call to</span></span><br><span class="line"><span class="comment">60       * &#123;<span class="doctag">@link</span> applyPayload&#125;. Values will be passed via the callback function</span></span><br><span class="line"><span class="comment">61       * &#123;<span class="doctag">@link</span> UpdateEngineCallback#onPayloadApplicationComplete&#125;. Values must</span></span><br><span class="line"><span class="comment">62       * agree with the ones in &#123;<span class="doctag">@code</span> system/update_engine/common/error_code.h&#125;.</span></span><br><span class="line"><span class="comment">63       */</span></span><br><span class="line"><span class="number">64</span>      <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">ErrorCodeConstants</span> &#123;</span><br><span class="line"><span class="number">65</span>          <span class="comment">/**</span></span><br><span class="line"><span class="comment">66           * Error code: a request finished successfully.</span></span><br><span class="line"><span class="comment">67           */</span></span><br><span class="line"><span class="number">68</span>          <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SUCCESS</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="number">69</span>          <span class="comment">/**</span></span><br><span class="line"><span class="comment">70           * Error code: a request failed due to a generic error.</span></span><br><span class="line"><span class="comment">71           */</span></span><br><span class="line"><span class="number">72</span>          <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ERROR</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="number">73</span>          <span class="comment">/**</span></span><br><span class="line"><span class="comment">74           * Error code: an update failed to apply due to filesystem copier</span></span><br><span class="line"><span class="comment">75           * error.</span></span><br><span class="line"><span class="comment">76           */</span></span><br><span class="line"><span class="number">77</span>          <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">FILESYSTEM_COPIER_ERROR</span> <span class="operator">=</span> <span class="number">4</span>;</span><br><span class="line"><span class="number">78</span>          <span class="comment">/**</span></span><br><span class="line"><span class="comment">79           * Error code: an update failed to apply due to an error in running</span></span><br><span class="line"><span class="comment">80           * post-install hooks.</span></span><br><span class="line"><span class="comment">81           */</span></span><br><span class="line"><span class="number">82</span>          <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">POST_INSTALL_RUNNER_ERROR</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line"><span class="number">83</span>          <span class="comment">/**</span></span><br><span class="line"><span class="comment">84           * Error code: an update failed to apply due to a mismatching payload.</span></span><br><span class="line"><span class="comment">85           *</span></span><br><span class="line"><span class="comment">86           * &lt;p&gt;For example, the given payload uses a feature that&#x27;s not</span></span><br><span class="line"><span class="comment">87           * supported by the current update engine.</span></span><br><span class="line"><span class="comment">88           */</span></span><br><span class="line"><span class="number">89</span>          <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">PAYLOAD_MISMATCHED_TYPE_ERROR</span> <span class="operator">=</span> <span class="number">6</span>;</span><br><span class="line"><span class="number">90</span>          <span class="comment">/**</span></span><br><span class="line"><span class="comment">91           * Error code: an update failed to apply due to an error in opening</span></span><br><span class="line"><span class="comment">92           * devices.</span></span><br><span class="line"><span class="comment">93           */</span></span><br><span class="line"><span class="number">94</span>          <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">INSTALL_DEVICE_OPEN_ERROR</span> <span class="operator">=</span> <span class="number">7</span>;</span><br><span class="line"><span class="number">95</span>          <span class="comment">/**</span></span><br><span class="line"><span class="comment">96           * Error code: an update failed to apply due to an error in opening</span></span><br><span class="line"><span class="comment">97           * kernel device.</span></span><br><span class="line"><span class="comment">98           */</span></span><br><span class="line"><span class="number">99</span>          <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">KERNEL_DEVICE_OPEN_ERROR</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line"><span class="number">100</span>          <span class="comment">/**</span></span><br><span class="line"><span class="comment">101           * Error code: an update failed to apply due to an error in fetching</span></span><br><span class="line"><span class="comment">102           * the payload.</span></span><br><span class="line"><span class="comment">103           *</span></span><br><span class="line"><span class="comment">104           * &lt;p&gt;For example, this could be a result of bad network connection</span></span><br><span class="line"><span class="comment">105           * when streaming an update.</span></span><br><span class="line"><span class="comment">106           */</span></span><br><span class="line"><span class="number">107</span>          <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DOWNLOAD_TRANSFER_ERROR</span> <span class="operator">=</span> <span class="number">9</span>;</span><br><span class="line"><span class="number">108</span>          <span class="comment">/**</span></span><br><span class="line"><span class="comment">109           * Error code: an update failed to apply due to a mismatch in payload</span></span><br><span class="line"><span class="comment">110           * hash.</span></span><br><span class="line"><span class="comment">111           *</span></span><br><span class="line"><span class="comment">112           * &lt;p&gt;Update engine does validity checks for the given payload and its</span></span><br><span class="line"><span class="comment">113           * metadata.</span></span><br><span class="line"><span class="comment">114           */</span></span><br><span class="line"><span class="number">115</span>          <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">PAYLOAD_HASH_MISMATCH_ERROR</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"><span class="number">116</span>  </span><br><span class="line"><span class="number">117</span>          <span class="comment">/**</span></span><br><span class="line"><span class="comment">118           * Error code: an update failed to apply due to a mismatch in payload</span></span><br><span class="line"><span class="comment">119           * size.</span></span><br><span class="line"><span class="comment">120           */</span></span><br><span class="line"><span class="number">121</span>          <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">PAYLOAD_SIZE_MISMATCH_ERROR</span> <span class="operator">=</span> <span class="number">11</span>;</span><br><span class="line"><span class="number">122</span>  </span><br><span class="line"><span class="number">123</span>          <span class="comment">/**</span></span><br><span class="line"><span class="comment">124           * Error code: an update failed to apply due to failing to verify</span></span><br><span class="line"><span class="comment">125           * payload signatures.</span></span><br><span class="line"><span class="comment">126           */</span></span><br><span class="line"><span class="number">127</span>          <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DOWNLOAD_PAYLOAD_VERIFICATION_ERROR</span> <span class="operator">=</span> <span class="number">12</span>;</span><br><span class="line"><span class="number">128</span>  </span><br><span class="line"><span class="number">129</span>          <span class="comment">/**</span></span><br><span class="line"><span class="comment">130           * Error code: an update failed to apply due to a downgrade in payload</span></span><br><span class="line"><span class="comment">131           * timestamp.</span></span><br><span class="line"><span class="comment">132           *</span></span><br><span class="line"><span class="comment">133           * &lt;p&gt;The timestamp of a build is encoded into the payload, which will</span></span><br><span class="line"><span class="comment">134           * be enforced during install to prevent downgrading a device.</span></span><br><span class="line"><span class="comment">135           */</span></span><br><span class="line"><span class="number">136</span>          <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">PAYLOAD_TIMESTAMP_ERROR</span> <span class="operator">=</span> <span class="number">51</span>;</span><br><span class="line"><span class="number">137</span>  </span><br><span class="line"><span class="number">138</span>          <span class="comment">/**</span></span><br><span class="line"><span class="comment">139           * Error code: an update has been applied successfully but the new slot</span></span><br><span class="line"><span class="comment">140           * hasn&#x27;t been set to active.</span></span><br><span class="line"><span class="comment">141           *</span></span><br><span class="line"><span class="comment">142           * &lt;p&gt;It indicates a successful finish of calling &#123;<span class="doctag">@link</span> #applyPayload&#125; with</span></span><br><span class="line"><span class="comment">143           * &#123;<span class="doctag">@code</span> SWITCH_SLOT_ON_REBOOT=0&#125;. See &#123;<span class="doctag">@link</span> #applyPayload&#125;.</span></span><br><span class="line"><span class="comment">144           */</span></span><br><span class="line"><span class="number">145</span>          <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">UPDATED_BUT_NOT_ACTIVE</span> <span class="operator">=</span> <span class="number">52</span>;</span><br><span class="line"><span class="number">146</span>  </span><br><span class="line"><span class="number">147</span>          <span class="comment">/**</span></span><br><span class="line"><span class="comment">148           * Error code: there is not enough space on the device to apply the update. User should</span></span><br><span class="line"><span class="comment">149           * be prompted to free up space and re-try the update.</span></span><br><span class="line"><span class="comment">150           *</span></span><br><span class="line"><span class="comment">151           * &lt;p&gt;See &#123;<span class="doctag">@link</span> UpdateEngine#allocateSpace&#125;.</span></span><br><span class="line"><span class="comment">152           */</span></span><br><span class="line"><span class="number">153</span>          <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">NOT_ENOUGH_SPACE</span> <span class="operator">=</span> <span class="number">60</span>;</span><br><span class="line"><span class="number">154</span>  </span><br><span class="line"><span class="number">155</span>          <span class="comment">/**</span></span><br><span class="line"><span class="comment">156           * Error code: the device is corrupted and no further updates may be applied.</span></span><br><span class="line"><span class="comment">157           *</span></span><br><span class="line"><span class="comment">158           * &lt;p&gt;See &#123;<span class="doctag">@link</span> UpdateEngine#cleanupAppliedPayload&#125;.</span></span><br><span class="line"><span class="comment">159           */</span></span><br><span class="line"><span class="number">160</span>          <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEVICE_CORRUPTED</span> <span class="operator">=</span> <span class="number">61</span>;</span><br><span class="line"><span class="number">161</span>      &#125;</span><br></pre></td></tr></table></figure><h4 id="注意事项："><a href="#注意事项：" class="headerlink" title="!!! 注意事项："></a>!!! 注意事项：</h4><p><a href="https://blog.csdn.net/xiaowang_lj/article/details/133387249">错误码汇总</a><br>adb remount后会导致失败会通过UpdateEngineCallback#onPayloadApplicationComplete(int errorCode)返回errorCode &#x3D; 7</p><p>remount的解决方式：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adb root</span><br><span class="line">adb enable-verity</span><br><span class="line">adb reboot</span><br></pre></td></tr></table></figure><h4 id="参考代码"><a href="#参考代码" class="headerlink" title="参考代码"></a>参考代码</h4><p><strong>UpdateEngine</strong>、<strong>UpdateEngineCallback</strong>可叫系统提供sdk支持</p><p><strong>UpdateParser</strong> 参考android-13.0.0_r3源码<a href="http://aospxref.com/android-13.0.0_r3/xref/packages/apps/Car/SystemUpdater/src/com/android/car/systemupdater/UpdateParser.java">UpdateParser</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Enumeration;</span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.ZipEntry;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.ZipFile;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/** Parse an A/B update zip file. */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UpdateParser</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TAG</span> <span class="operator">=</span> <span class="string">&quot;ROTAUpdateManager&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PAYLOAD_BIN_FILE</span> <span class="operator">=</span> <span class="string">&quot;payload.bin&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PAYLOAD_PROPERTIES</span> <span class="operator">=</span> <span class="string">&quot;payload_properties.txt&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">FILE_URL_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;file://&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ZIP_FILE_HEADER</span> <span class="operator">=</span> <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">UpdateParser</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="title function_">getOffset</span><span class="params">(ZipEntry zipEntry, String str)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (zipEntry.getMethod() != <span class="number">0</span> ? <span class="number">16</span> : <span class="number">0</span>) + <span class="number">30</span> + str.length() + zipEntry.getCompressedSize() + (zipEntry.getExtra() != <span class="literal">null</span> ? zipEntry.getExtra().length : <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Parse a zip file containing a system update and return a non null ParsedUpdate.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ParsedUpdate <span class="title function_">parse</span><span class="params">(File file)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">payloadOffset</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">long</span> <span class="variable">payloadSize</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">payloadFound</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        String[] props = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">ZipFile</span> <span class="variable">zipFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ZipFile</span>(file)) &#123;</span><br><span class="line">            Enumeration&lt;? <span class="keyword">extends</span> <span class="title class_">ZipEntry</span>&gt; entries = zipFile.entries();</span><br><span class="line">            <span class="keyword">while</span> (entries.hasMoreElements()) &#123;</span><br><span class="line">                <span class="type">ZipEntry</span> <span class="variable">entry</span> <span class="operator">=</span> entries.nextElement();</span><br><span class="line">                <span class="type">long</span> <span class="variable">fileSize</span> <span class="operator">=</span> entry.getCompressedSize();</span><br><span class="line">                <span class="keyword">if</span> (!payloadFound) &#123;</span><br><span class="line">                    payloadOffset += ZIP_FILE_HEADER + entry.getName().length();</span><br><span class="line">                    <span class="keyword">if</span> (entry.getExtra() != <span class="literal">null</span>) &#123;</span><br><span class="line">                        payloadOffset += entry.getExtra().length;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (entry.isDirectory()) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (entry.getName().equals(PAYLOAD_BIN_FILE)) &#123;</span><br><span class="line">                    payloadSize = fileSize;</span><br><span class="line">                    payloadFound = <span class="literal">true</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (entry.getName().equals(PAYLOAD_PROPERTIES)) &#123;</span><br><span class="line">                    <span class="keyword">try</span> (<span class="type">BufferedReader</span> <span class="variable">buffer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(</span><br><span class="line">                            <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(zipFile.getInputStream(entry)))) &#123;</span><br><span class="line">                        props = buffer.lines().toArray(String[]::<span class="keyword">new</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (!payloadFound) &#123;</span><br><span class="line">                    payloadOffset += fileSize;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//if (Log.isLoggable(TAG, Log.DEBUG)) &#123;</span></span><br><span class="line">                    Log.d(TAG, String.format(<span class="string">&quot;Entry %s&quot;</span>, entry.getName()));</span><br><span class="line">                <span class="comment">//&#125;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ParsedUpdate</span>(file, payloadOffset, payloadSize, props);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Information parsed from an update file. */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ParsedUpdate</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> String mUrl;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> mOffset;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> mSize;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> String[] mProps;</span><br><span class="line"></span><br><span class="line">        ParsedUpdate(File file, <span class="type">long</span> offset, <span class="type">long</span> size, String[] props) &#123;</span><br><span class="line">            mUrl = FILE_URL_PREFIX + file.getAbsolutePath();</span><br><span class="line">            mOffset = offset;</span><br><span class="line">            mSize = size;</span><br><span class="line">            mProps = props;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** Verify the update information is correct. */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> mOffset &gt;= <span class="number">0</span> &amp;&amp; mSize &gt; <span class="number">0</span> &amp;&amp; mProps != <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> String.format(Locale.getDefault(),</span><br><span class="line">                    <span class="string">&quot;ParsedUpdate: URL=%s, offset=%d, size=%s, props=%s&quot;</span>,</span><br><span class="line">                    mUrl, mOffset, mSize, Arrays.toString(mProps));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OTA </tag>
            
            <tag> UpdateEngine </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>记一次WIFI 密码错误判断实现</title>
      <link href="/2024/07/09/Wifi%E5%AF%86%E7%A0%81%E9%94%99%E8%AF%AF/"/>
      <url>/2024/07/09/Wifi%E5%AF%86%E7%A0%81%E9%94%99%E8%AF%AF/</url>
      
        <content type="html"><![CDATA[<p>需求： wifi密码错误、弹出提示</p><p>在网上找了半天大部分都是以下方式实现的</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NetworkStateReceiver</span> <span class="keyword">extends</span> <span class="title class_">BroadcastReceiver</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onReceive</span><span class="params">(Context context, Intent intent)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">action</span> <span class="operator">=</span> intent.getAction();</span><br><span class="line">        <span class="keyword">if</span> (action.equals(WifiManager.SUPPLICANT_CONNECTION_CHANGE_ACTION)) &#123;</span><br><span class="line">            <span class="type">SupplicantState</span> <span class="variable">supState</span> <span class="operator">=</span> intent.getParcelableExtra(WifiManager.EXTRA_NEW_STATE);</span><br><span class="line">            <span class="keyword">if</span> (supState == SupplicantState.DISCONNECTED) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">error</span> <span class="operator">=</span> intent.getIntExtra(WifiManager.EXTRA_SUPPLICANT_ERROR, -<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">if</span> (error == WifiManager.ERROR_AUTHENTICATING) &#123;</span><br><span class="line">                    Toast.makeText(context, <span class="string">&quot;WiFi密码错误&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>经测试验证非密码错误也会走到里面</p><p>参考博客<a href="https://blog.csdn.net/sinat_20059415/article/details/103534598">Android Q 学习WiFi AP的禁用</a>后找了WifiConfiguration源码查看 <a href="http://aospxref.com/android-13.0.0_r3/xref/packages/modules/Wifi/framework/java/android/net/wifi/WifiConfiguration.java">WifiConfiguration</a> <strong>Status</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/** Possible status of a network configuration. */</span></span><br><span class="line"><span class="number">472</span>      <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Status</span> &#123;</span><br><span class="line"><span class="number">473</span>          <span class="keyword">private</span> <span class="title function_">Status</span><span class="params">()</span> &#123; &#125;</span><br><span class="line"><span class="number">474</span>  </span><br><span class="line"><span class="number">475</span>          <span class="comment">/** this is the network we are currently connected to */</span></span><br><span class="line"><span class="number">476</span>          <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">CURRENT</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="number">477</span>          <span class="comment">/** supplicant will not attempt to use this network */</span></span><br><span class="line"><span class="number">478</span>          <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DISABLED</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="number">479</span>          <span class="comment">/** supplicant will consider this network available for association */</span></span><br><span class="line"><span class="number">480</span>          <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ENABLED</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"><span class="number">481</span>  </span><br><span class="line"><span class="number">482</span>          <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] strings = &#123; <span class="string">&quot;current&quot;</span>, <span class="string">&quot;disabled&quot;</span>, <span class="string">&quot;enabled&quot;</span> &#125;;</span><br><span class="line"><span class="number">483</span>      &#125;</span><br><span class="line"><span class="number">484</span>  </span><br></pre></td></tr></table></figure><p>解决方式：<strong>在收到对应广播后判断下status</strong></p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> wifi = WiFiUtil.getInstance(wifiManager).everConnected(wifiName)</span><br><span class="line"><span class="keyword">if</span> (wifi.status != WifiConfiguration.Status.DISABLED) &#123;</span><br><span class="line"><span class="comment">// 如果WifiConfiguration.Status.DISABLED说明没连接上过</span></span><br><span class="line">    LogUtil.d(<span class="string">&quot;everConnected.status != WifiConfiguration.Status.DISABLED&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>工具方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> WifiConfiguration <span class="title function_">everConnected</span><span class="params">(String ssid)</span> &#123;</span><br><span class="line">    List&lt;WifiConfiguration&gt; existingConfigs = mWifiManager.getConfiguredNetworks();</span><br><span class="line">    <span class="keyword">if</span> (existingConfigs == <span class="literal">null</span> || existingConfigs.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ssid = <span class="string">&quot;\&quot;&quot;</span> + ssid + <span class="string">&quot;\&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (WifiConfiguration existingConfig : existingConfigs) &#123;</span><br><span class="line">        <span class="keyword">if</span> (existingConfig.SSID.equals(ssid)) &#123;</span><br><span class="line">            <span class="keyword">return</span> existingConfig;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WIFI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Switch 自定义样式</title>
      <link href="/2024/03/27/Switch%20%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%B7%E5%BC%8F/"/>
      <url>/2024/03/27/Switch%20%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%B7%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>最终效果</p><img src="https://cdn.jsdelivr.net/gh/xmbest/image/img/202407211709216.png" alt="滑块打开样式" style="zoom: 67%;" /><img src="https://cdn.jsdelivr.net/gh/xmbest/image/img/202407211710882.png" alt="滑块关闭样式" style="zoom:67%;" /><p>minHeight，switchMinWidth调整switch开关高度、宽度</p><p>android:thumb   开关按钮上原型滑块的样式</p><p>android:track  开关按钮下面导轨的样式</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Switch</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;48dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;24dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginEnd</span>=<span class="string">&quot;21dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">&quot;@null&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:minHeight</span>=<span class="string">&quot;24dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:switchMinWidth</span>=<span class="string">&quot;48dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:thumb</span>=<span class="string">&quot;@drawable/selector_switch_thumb&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:track</span>=<span class="string">&quot;@drawable/selector_switch_track&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">&quot;@+id/tv_br_top&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>selector_switch_thumb.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layer-list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:width</span>=<span class="string">&quot;18dp&quot;</span> <span class="attr">android:height</span>=<span class="string">&quot;24dp&quot;</span> <span class="attr">android:drawable</span>=<span class="string">&quot;@mipmap/ic_track&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layer-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></span><br></pre></td></tr></table></figure><p>selector_switch_track.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_checked</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layer-list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:width</span>=<span class="string">&quot;48dp&quot;</span> <span class="attr">android:height</span>=<span class="string">&quot;24dp&quot;</span> <span class="attr">android:drawable</span>=<span class="string">&quot;@mipmap/ic_thumb_off&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layer-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_checked</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layer-list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:width</span>=<span class="string">&quot;48dp&quot;</span> <span class="attr">android:height</span>=<span class="string">&quot;24dp&quot;</span> <span class="attr">android:drawable</span>=<span class="string">&quot;@mipmap/ic_thumb_on&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layer-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></span><br></pre></td></tr></table></figure><p>对应素材<br>ic_thumb_off<br><img src="https://cdn.jsdelivr.net/gh/xmbest/image/img/202407211712944.png"><br>ic_thumb_on<br><img src="https://cdn.jsdelivr.net/gh/xmbest/image/img/202407211712605.png"><br>ic_track<br><img src="https://cdn.jsdelivr.net/gh/xmbest/image/img/202407211712654.png"></p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>git远程仓库已有初始化文件</title>
      <link href="/2024/01/30/git%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E5%B7%B2%E6%9C%89%E5%88%9D%E5%A7%8B%E5%8C%96%E6%96%87%E4%BB%B6/"/>
      <url>/2024/01/30/git%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E5%B7%B2%E6%9C%89%E5%88%9D%E5%A7%8B%E5%8C%96%E6%96%87%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h3 id="git远程仓库已有README等初始化文件"><a href="#git远程仓库已有README等初始化文件" class="headerlink" title="git远程仓库已有README等初始化文件"></a>git远程仓库已有README等初始化文件</h3><blockquote><p>本地项目未commit</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">git remote add origin xxx(项目地址)</span><br><span class="line">git pull origin master</span><br></pre></td></tr></table></figure><blockquote><p>本地项目已commit</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin xxx(项目地址)</span><br><span class="line">git pull origin master --allow-unrelated-histories</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Gradle失败解决方式</title>
      <link href="/2023/12/31/Gradle%20%E4%B8%8B%E8%BD%BD%E5%A4%B1%E8%B4%A5/"/>
      <url>/2023/12/31/Gradle%20%E4%B8%8B%E8%BD%BD%E5%A4%B1%E8%B4%A5/</url>
      
        <content type="html"><![CDATA[<h3 id="解决网络等问题导致Android-Studio-下载-Gradle失败"><a href="#解决网络等问题导致Android-Studio-下载-Gradle失败" class="headerlink" title="解决网络等问题导致Android Studio 下载 Gradle失败"></a>解决网络等问题导致Android Studio 下载 Gradle失败</h3><p><strong>腾讯镜像</strong>：<a href="https://mirrors.cloud.tencent.com/gradle/">https://mirrors.cloud.tencent.com/gradle/</a><br><strong>阿里镜像</strong>：<a href="https://mirrors.aliyun.com/gradle/">https://mirrors.aliyun.com/gradle/</a><br>选择以上镜像，下载项目对应版本 gradle.zip</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">切换到gradle 目录</span></span><br><span class="line">cd /Users/用户名/.gradle/wrapper/dists</span><br></pre></td></tr></table></figure><p>如下图所示<br><img src="https://cdn.jsdelivr.net/gh/xmbest/image/img/202407211714407.png"><br>找到对应版本，进入最内层目录将以上下载的 gradle.zip复制并解压到当前目录，如下图所示<br><img src="https://cdn.jsdelivr.net/gh/xmbest/image/img/202407211715702.png"><br> Android Studio 同步后如下图所示<br><img src="https://cdn.jsdelivr.net/gh/xmbest/image/img/202407211715434.png"></p>]]></content>
      
      
      <categories>
          
          <category> Gradle </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Mac JDK环境配置</title>
      <link href="/2023/07/21/Mac%20JDK%20%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"/>
      <url>/2023/07/21/Mac%20JDK%20%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h3 id="安装JDK"><a href="#安装JDK" class="headerlink" title="安装JDK"></a>安装JDK</h3><ol><li>进入azul下载对应版本、安装</li></ol><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.azul.com/downloads/</span><br></pre></td></tr></table></figure><ol start="2"><li>查看安装路径</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/usr/libexec/java_home -V</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出以下内容</span></span><br><span class="line">Matching Java Virtual Machines (2):</span><br><span class="line">    16.0.2 (arm64) &quot;Azul Systems, Inc.&quot; - &quot;Zulu 16.32.15&quot; /Users/xiaoming/Library/Java/JavaVirtualMachines/azul-16.0.2/Contents/Home</span><br><span class="line">    1.8.0_382 (arm64) &quot;Azul Systems, Inc.&quot; - &quot;Zulu 8.72.0.17&quot; /Library/Java/JavaVirtualMachines/zulu-8.jdk/Contents/Home</span><br><span class="line">/Users/xiaoming/Library/Java/JavaVirtualMachines/azul-16.0.2/Contents/Home</span><br></pre></td></tr></table></figure><ol start="3"><li>配置环境变量</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bash_profile</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">按i键进入输入模式粘贴以下内容</span></span><br><span class="line">JAVA_HOME=/Library/Java/JavaVirtualMachines/zulu-8.jdk/Contents/Home</span><br><span class="line">PATH=$PATH:$JAVA_HOME/bin/:.</span><br><span class="line">CLASSPATH=$JAVA_HOME/lib/tools.jar:$JAVA_HOME/lib/dt.jar:.</span><br><span class="line">export JAVA_HOME</span><br><span class="line">export PATH</span><br><span class="line">export CLASSPATH</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">按ESC进入命令模式输入以下内容</span></span><br><span class="line">:wq</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">生效该配置文件</span></span><br><span class="line">source ~/.bash_profile</span><br></pre></td></tr></table></figure><ol start="4"><li>发现退出终端再打开时输入常用命令不识别，且输出以下内容</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zsh: command not found: ls</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.zshrc</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">按i键进入输入模式粘贴以下内容</span></span><br><span class="line">source ~/.bash_profile</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">按ESC进入命令模式输入以下内容</span></span><br><span class="line">:wq</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">生效该配置文件</span></span><br><span class="line">source ~/.bash_profile</span><br></pre></td></tr></table></figure><h3 id="安装Maven"><a href="#安装Maven" class="headerlink" title="安装Maven"></a>安装Maven</h3><ol><li>下载maven压缩包解压到指定目录</li><li>配置环境变量</li><li>mvn -v 查看是否成功</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">~/.bash_profile内容</span></span><br><span class="line">JAVA_HOME=/Library/Java/JavaVirtualMachines/zulu-8.jdk/Contents/Home</span><br><span class="line">M2_HOME=/Users/xiaoming/environment/apache-maven-3.9.3</span><br><span class="line">PATH=$PATH:$JAVA_HOME/bin/:$M2_HOME/bin:.</span><br><span class="line">CLASSPATH=$JAVA_HOME/lib/tools.jar:$JAVA_HOME/lib/dt.jar:.</span><br><span class="line">export JAVA_HOME</span><br><span class="line">export M2_HOME</span><br><span class="line">export PATH</span><br><span class="line">export CLASSPATH</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">当前~/.bash_profile</span></span><br><span class="line">JAVA_HOME=/Library/Java/JavaVirtualMachines/zulu-8.jdk/Contents/Home</span><br><span class="line">SDK_HOME=/Users/xiaoming/Library/Android/sdk</span><br><span class="line">FLUTTER=/Users/xiaoming/Environment/flutter</span><br><span class="line">M2_HOME=/Users/xiaoming/Environment/apache-maven-3.9.3</span><br><span class="line">GIT=/opt/homebrew/bin/git</span><br><span class="line">PUB_HOSTED_URL=&quot;https://pub.flutter-io.cn&quot;</span><br><span class="line">FLUTTER_STORAGE_BASE_URL=&quot;https://storage.flutter-io.cn&quot;</span><br><span class="line">PATH=$PATH:$JAVA_HOME/bin/:$FLUTTER/bin/:$SDK_HOME/platform-tools/:$SDK_HOME/build-tools/30.0.3/:$M2_HOME/bin:$GIT/bin:.</span><br><span class="line">CLASSPATH=$JAVA_HOME/lib/tools.jar:$JAVA_HOME/lib/dt.jar:.</span><br><span class="line">export PUB_HOSTED_URL</span><br><span class="line">export FLUTTER_STORAGE_BASE_URL</span><br><span class="line">export JAVA_HOME</span><br><span class="line">export SDK_HOME</span><br><span class="line">export M2_HOME</span><br><span class="line">export GIT</span><br><span class="line">export PATH</span><br><span class="line">export CLASSPATH</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Mac </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>AudioRecord 学习</title>
      <link href="/2023/06/23/AudioRecord%20%E5%AD%A6%E4%B9%A0/"/>
      <url>/2023/06/23/AudioRecord%20%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h2 id="音频基础"><a href="#音频基础" class="headerlink" title="音频基础"></a>音频基础</h2><blockquote><p>声音是一种由物体振动引发的物理现象，如小提琴的弦声等。物体的振动使其四周空气的压强产生变化，这种忽强忽弱变化以波的形式向四周传播，当被人耳所接收时我们就听见了声音。</p></blockquote><h3 id="波形"><a href="#波形" class="headerlink" title="波形"></a>波形</h3><blockquote><p>声音是由物体的振动产生，这种振动引起了周围空气压强的振荡，我们称这种振荡的函数表现形式为波形</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/xmbest/image/img/202407211716600.png"></p><h3 id="频率"><a href="#频率" class="headerlink" title="频率"></a>频率</h3><blockquote><p>声音的频率的周期的倒数，它表示的是声音在1s内的周期数，单位时赫兹(Hz，1000Hz表示每秒振动1000次</p></blockquote><table><thead><tr><th>声波</th><th>范围（单位Hz）</th></tr></thead><tbody><tr><td>次声</td><td>0~20</td></tr><tr><td>人耳</td><td>20~20K</td></tr><tr><td>超声</td><td>20K~1G</td></tr><tr><td>特超声</td><td>1G~10T</td></tr></tbody></table><p>采样定理：<strong>两倍频率去采集</strong></p><p>麦克风采集模拟世界<strong>20</strong>KHz -&gt; AD -&gt; 计算机采样的2倍的<strong>20</strong>KHz（48KHz、<strong>44.1</strong>KHz）-&gt;<strong>DA</strong>转换-&gt;喇叭播放</p><h3 id="采样精度-深度"><a href="#采样精度-深度" class="headerlink" title="采样精度(深度)"></a>采样精度(深度)</h3><blockquote><p>每个样本点的大小，常用8bit、16bit、24bit</p></blockquote><h3 id="通道数"><a href="#通道数" class="headerlink" title="通道数"></a>通道数</h3><blockquote><p>单声道、双声道、3、4、6</p></blockquote><h3 id="帧"><a href="#帧" class="headerlink" title="帧"></a>帧</h3><blockquote><p>音频的概念没那么清晰，视频编码格式可以简单认为一帧就是编码后的一张图像</p></blockquote><p><strong>帧长</strong>：(1)可以指每帧采样数播放的时间,mp3 48k,1152个采样点，每帧为2ms; aac则是每帧是1024个采样点。 攒够一帧的数据才送去做编码(2) 也可以指压缩后每的数据长度。</p><p>每持续时间(秒) &#x3D; 每采样点数 &#x2F; 采样频率 (HZ)</p><h3 id="存储方式"><a href="#存储方式" class="headerlink" title="存储方式"></a>存储方式</h3><p><strong>交错模式</strong>：数据以连续帧的方式进行存放，首先记录帧1的左声道样本和右声道样本再记录下一帧</p><table><thead><tr><th align="center">L</th><th align="center">R</th><th align="center">L</th><th align="center">R</th><th align="center">L</th><th align="center">R</th><th align="center">…</th></tr></thead></table><p><strong>非交错模式</strong>：记录一个周期内所有帧的左声道样本再记录所有右声道样本</p><table><thead><tr><th align="center">L</th><th align="center">L</th><th align="center">L</th><th align="center">…</th><th align="center">R</th><th align="center">R</th><th align="center">R</th></tr></thead></table><h2 id="Android音频"><a href="#Android音频" class="headerlink" title="Android音频"></a>Android音频</h2><h3 id="AudioRecord"><a href="#AudioRecord" class="headerlink" title="AudioRecord"></a>AudioRecord</h3><blockquote><p>在Android中，使用android.media.AudioRecord可实现灵活的录音配置，录取的是原始的pcm数据</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Class constructor.</span></span><br><span class="line"><span class="comment">     * Though some invalid parameters will result in an &#123;<span class="doctag">@link</span> IllegalArgumentException&#125; exception,</span></span><br><span class="line"><span class="comment">     * other errors do not.  Thus you should call &#123;<span class="doctag">@link</span> #getState()&#125; immediately after construction</span></span><br><span class="line"><span class="comment">     * to confirm that the object is usable.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> audioSource the recording source.</span></span><br><span class="line"><span class="comment">     *   See &#123;<span class="doctag">@link</span> MediaRecorder.AudioSource&#125; for the recording source definitions.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sampleRateInHz the sample rate expressed in Hertz. 44100Hz is currently the only</span></span><br><span class="line"><span class="comment">     *   rate that is guaranteed to work on all devices, but other rates such as 22050,</span></span><br><span class="line"><span class="comment">     *   16000, and 11025 may work on some devices.</span></span><br><span class="line"><span class="comment">     *   &#123;<span class="doctag">@link</span> AudioFormat#SAMPLE_RATE_UNSPECIFIED&#125; means to use a route-dependent value</span></span><br><span class="line"><span class="comment">     *   which is usually the sample rate of the source.</span></span><br><span class="line"><span class="comment">     *   &#123;<span class="doctag">@link</span> #getSampleRate()&#125; can be used to retrieve the actual sample rate chosen.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> channelConfig describes the configuration of the audio channels.</span></span><br><span class="line"><span class="comment">     *   See &#123;<span class="doctag">@link</span> AudioFormat#CHANNEL_IN_MONO&#125; and</span></span><br><span class="line"><span class="comment">     *   &#123;<span class="doctag">@link</span> AudioFormat#CHANNEL_IN_STEREO&#125;.  &#123;<span class="doctag">@link</span> AudioFormat#CHANNEL_IN_MONO&#125; is guaranteed</span></span><br><span class="line"><span class="comment">     *   to work on all devices.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> audioFormat the format in which the audio data is to be returned.</span></span><br><span class="line"><span class="comment">     *   See &#123;<span class="doctag">@link</span> AudioFormat#ENCODING_PCM_8BIT&#125;, &#123;<span class="doctag">@link</span> AudioFormat#ENCODING_PCM_16BIT&#125;,</span></span><br><span class="line"><span class="comment">     *   and &#123;<span class="doctag">@link</span> AudioFormat#ENCODING_PCM_FLOAT&#125;.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bufferSizeInBytes the total size (in bytes) of the buffer where audio data is written</span></span><br><span class="line"><span class="comment">     *   to during the recording. New audio data can be read from this buffer in smaller chunks</span></span><br><span class="line"><span class="comment">     *   than this size. See &#123;<span class="doctag">@link</span> #getMinBufferSize(int, int, int)&#125; to determine the minimum</span></span><br><span class="line"><span class="comment">     *   required buffer size for the successful creation of an AudioRecord instance. Using values</span></span><br><span class="line"><span class="comment">     *   smaller than getMinBufferSize() will result in an initialization failure.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> java.lang.IllegalArgumentException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">AudioRecord</span><span class="params">(<span class="type">int</span> audioSource, <span class="type">int</span> sampleRateInHz, <span class="type">int</span> channelConfig, <span class="type">int</span> audioFormat, <span class="type">int</span> bufferSizeInBytes)</span></span><br></pre></td></tr></table></figure><p><strong>audioSource</strong>: 音频录制的音源</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> android.media;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MediaRecorder</span> <span class="keyword">implements</span> <span class="title class_">AudioRouting</span>,</span><br><span class="line">                                      AudioRecordingMonitor,</span><br><span class="line">                                      AudioRecordingMonitorClient,</span><br><span class="line">                                      MicrophoneDirection&#123;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 省略</span></span><br><span class="line"><span class="comment">   */</span>                                   </span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">AudioSource</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">AudioSource</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">        <span class="comment">//默认音频源</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">       <span class="comment">//设定录音来源为主麦克风</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MIC</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">       <span class="comment">//上行声音</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">VOICE_UPLINK</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">       <span class="comment">//下行声音</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">VOICE_DOWNLINK</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">        <span class="comment">//设定录音来源为语音拨出的语音与对方说话的声音</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">VOICE_CALL</span> <span class="operator">=</span> <span class="number">4</span>;</span><br><span class="line">       <span class="comment">//设定录音来源于同方向的相机麦克风相同，若相机无内置相机或无法识别，则使用预设的麦克风</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">CAMCORDER</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">       <span class="comment">//语音识别</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">VOICE_RECOGNITION</span> <span class="operator">=</span> <span class="number">6</span>;</span><br><span class="line">       <span class="comment">//摄像头旁边的麦克风</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">VOICE_COMMUNICATION</span> <span class="operator">=</span> <span class="number">7</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">REMOTE_SUBMIX</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">UNPROCESSED</span> <span class="operator">=</span> <span class="number">9</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">VOICE_PERFORMANCE</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ECHO_REFERENCE</span> <span class="operator">=</span> <span class="number">1997</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">RADIO_TUNER</span> <span class="operator">=</span> <span class="number">1998</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">HOTWORD</span> <span class="operator">=</span> <span class="number">1999</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ULTRASOUND</span> <span class="operator">=</span> <span class="number">2000</span>;</span><br><span class="line">   &#125;   </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 省略</span></span><br><span class="line"><span class="comment">   */</span>                               </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>sampleRateInHz</strong>：音频采样率，即可每秒中采集多少个音频数据</p><blockquote><p>44100Hz是目前唯一保证在所有设备上工作的采样率，但其他速率如22050、16000和11025可能在某些设备上无法工作</p></blockquote><p><strong>channelConfig</strong>: 录音通道，单通道为 AudioFormat.CHANNEL_IN_MONO，双通道为AudioFormat.CHANNEL_IN_STEREO</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">CHANNEL_IN_LEFT</span> <span class="operator">=</span> <span class="number">0x4</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">CHANNEL_IN_RIGHT</span> <span class="operator">=</span> <span class="number">0x8</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">CHANNEL_IN_FRONT</span> <span class="operator">=</span> <span class="number">0x10</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">CHANNEL_IN_BACK</span> <span class="operator">=</span> <span class="number">0x20</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">CHANNEL_IN_MONO</span> <span class="operator">=</span> CHANNEL_IN_FRONT;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">CHANNEL_IN_STEREO</span> <span class="operator">=</span> (CHANNEL_IN_LEFT | CHANNEL_IN_RIGHT);</span><br></pre></td></tr></table></figure><p><strong>audioFormat</strong>: 音频每个采样点的位数，即音频的精度，通道选用AudioFormat.ENCODING_PCM_16BIT即pcm 16位即可</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">AudioFormat</span> <span class="keyword">implements</span> <span class="title class_">Parcelable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//---------------------------------------------------------</span></span><br><span class="line">    <span class="comment">// Constants</span></span><br><span class="line">    <span class="comment">//--------------------</span></span><br><span class="line">    <span class="comment">/** Invalid audio data format */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ENCODING_INVALID</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">/** Default audio data format */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ENCODING_DEFAULT</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// These values must be kept in sync with core/jni/android_media_AudioFormat.h</span></span><br><span class="line">    <span class="comment">// Also sync av/services/audiopolicy/managerdefault/ConfigParsingUtils.h</span></span><br><span class="line">    <span class="comment">/** Audio data format: PCM 16 bit per sample. Guaranteed to be supported by devices. */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ENCODING_PCM_16BIT</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">    <span class="comment">/** Audio data format: PCM 8 bit per sample. Not guaranteed to be supported by devices. */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ENCODING_PCM_8BIT</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">    <span class="comment">/** Audio data format: single-precision floating-point per sample */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ENCODING_PCM_FLOAT</span> <span class="operator">=</span> <span class="number">4</span>;</span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 省略</span></span><br><span class="line"><span class="comment">   */</span>      </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>bufferSizeInBytes</strong>: 音频数据写入缓冲区的总数，通过 AudioRecord.getMinBufferSize 获取最小的缓冲区。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getMinBufferSize</span><span class="params">(<span class="type">int</span> sampleRateInHz, <span class="type">int</span> channelConfig, <span class="type">int</span> audioFormat)</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AudioRecord </tag>
            
            <tag> 音频 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue 全局配置 WebSocket</title>
      <link href="/2023/05/09/Vue%20%E5%85%A8%E5%B1%80%E4%BD%BF%E7%94%A8%20WebSocket/"/>
      <url>/2023/05/09/Vue%20%E5%85%A8%E5%B1%80%E4%BD%BF%E7%94%A8%20WebSocket/</url>
      
        <content type="html"><![CDATA[<blockquote><p>服务端可以主动向客户端推送数据，浏览器和服务器只需要完成一次握手，两者之间就可以创建持久性的连接，并进行双向数据传输</p></blockquote><h3 id="创建文件-xx-global-js，且在main中引用"><a href="#创建文件-xx-global-js，且在main中引用" class="headerlink" title="创建文件&#x2F;xx&#x2F;global.js，且在main中引用"></a>创建文件&#x2F;xx&#x2F;global.js，且在main中引用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// global.js 文件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">ws</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">setWs</span>: <span class="keyword">function</span>(<span class="params">newWs</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ws</span> = newWs</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//vue2 main.js 文件</span></span><br><span class="line"><span class="keyword">import</span> <span class="variable language_">global</span> <span class="keyword">from</span> <span class="string">&#x27;./xx/global.js&#x27;</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">global</span> = <span class="variable language_">global</span> <span class="comment">//vue2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// vue3 main.js 文件</span></span><br><span class="line"><span class="keyword">import</span> <span class="variable language_">global</span> <span class="keyword">from</span> <span class="string">&#x27;./xx/global.js&#x27;</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>)</span><br><span class="line">app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">global</span> = <span class="variable language_">global</span></span><br></pre></td></tr></table></figure><h3 id="在合适地方进行初始化"><a href="#在合适地方进行初始化" class="headerlink" title="在合适地方进行初始化"></a>在合适地方进行初始化</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">localSocket</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="keyword">let</span> that = <span class="variable language_">this</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="string">&quot;WebSocket&quot;</span> <span class="keyword">in</span> <span class="variable language_">window</span>) &#123;</span><br><span class="line">      that.<span class="property">ws</span> = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&quot;ws://localhost:8081/xxx)</span></span><br><span class="line"><span class="string">      that.global.setWs(that.ws)</span></span><br><span class="line"><span class="string">      that.ws.onopen = function () &#123;</span></span><br><span class="line"><span class="string">          console.log(&#x27;websocket连接成功&#x27;)</span></span><br><span class="line"><span class="string">      &#125;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">      that.ws.onclose = function () &#123;</span></span><br><span class="line"><span class="string">          // 关闭 websocket</span></span><br><span class="line"><span class="string">          console.log(&quot;</span>连接已关闭...<span class="string">&quot;)</span></span><br><span class="line"><span class="string">          //断线重新连接</span></span><br><span class="line"><span class="string">          // setTimeout(() =&gt; &#123;</span></span><br><span class="line"><span class="string">          //     that.localSocket()</span></span><br><span class="line"><span class="string">          // &#125;, 2000)</span></span><br><span class="line"><span class="string">      &#125;;</span></span><br><span class="line"><span class="string">  &#125; else &#123;</span></span><br><span class="line"><span class="string">      // 浏览器不支持 WebSocket</span></span><br><span class="line"><span class="string">      console.log(&quot;</span>您的浏览器不支持 <span class="title class_">WebSocket</span>!<span class="string">&quot;)</span></span><br><span class="line"><span class="string">      this.openNotificationWithIcon(&#x27;error&#x27;, &#x27;浏览器&#x27;, &#x27;您的浏览器不支持显示消息请更换&#x27;, 1, 1)</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="在Vue2中使用"><a href="#在Vue2中使用" class="headerlink" title="在Vue2中使用"></a>在Vue2中使用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">handdleMsg</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> that = <span class="variable language_">this</span>;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(that.<span class="property">global</span>.<span class="property">ws</span>);</span><br><span class="line">            <span class="keyword">if</span> (that.<span class="property">global</span>.<span class="property">ws</span> &amp;&amp; that.<span class="property">global</span>.<span class="property">ws</span>.<span class="property">readyState</span> == <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;发送信息&quot;</span>, <span class="variable language_">this</span>.<span class="property">data</span>)</span><br><span class="line">                that.<span class="property">global</span>.<span class="property">ws</span>.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(xxx))</span><br><span class="line">            &#125;</span><br><span class="line">            that.<span class="property">global</span>.<span class="property">ws</span>.<span class="property">onmessage</span> = <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;收到服务器内容&quot;</span>, res)</span><br><span class="line">                <span class="keyword">let</span> obj = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(res.<span class="property">data</span>)</span><br><span class="line">              <span class="comment">//操作</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h3 id="在Vue3中使用"><a href="#在Vue3中使用" class="headerlink" title="在Vue3中使用"></a>在Vue3中使用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, reactive, getCurrentInstance, computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="attr">appContext</span>: &#123; <span class="attr">config</span>: &#123; <span class="attr">globalProperties</span>: <span class="variable language_">global</span> &#125; &#125; &#125; = <span class="title function_">getCurrentInstance</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handdleMsg</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> that = <span class="variable language_">global</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(that.<span class="property">global</span>.<span class="property">ws</span>);</span><br><span class="line">    <span class="keyword">if</span> (that.<span class="property">global</span>.<span class="property">ws</span> &amp;&amp; that.<span class="property">global</span>.<span class="property">ws</span>.<span class="property">readyState</span> == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;发送信息&quot;</span>, data.<span class="property">arr</span>);</span><br><span class="line">        that.<span class="property">global</span>.<span class="property">ws</span>.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; ...data.<span class="property">arr</span>, <span class="attr">t</span>: list.<span class="property">arr</span>[data.<span class="property">arr</span>.<span class="property">t</span>].<span class="property">t</span> &#125;));</span><br><span class="line">        data.<span class="property">arr</span>.<span class="property">content</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    that.<span class="property">global</span>.<span class="property">ws</span>.<span class="property">onmessage</span> = <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;收到服务器内容&quot;</span>, res);</span><br><span class="line">        <span class="keyword">let</span> obj = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(res.<span class="property">data</span>)</span><br><span class="line">        <span class="keyword">let</span> i = data.<span class="property">arr</span>.<span class="property">t</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(i);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; list.<span class="property">arr</span>.<span class="property">length</span>; index++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (list.<span class="property">arr</span>[index].<span class="property">t</span> === obj.<span class="property">t</span> || list.<span class="property">arr</span>[index].<span class="property">t</span> === obj.<span class="property">f</span>) &#123;</span><br><span class="line">                i = index</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        chats.<span class="property">arr</span>[i].<span class="title function_">push</span>(obj)</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
          <category> JS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>FastDfs 简单使用</title>
      <link href="/2022/10/12/FastDfs%20%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"/>
      <url>/2022/10/12/FastDfs%20%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="FastDfs安装"><a href="#FastDfs安装" class="headerlink" title="FastDfs安装"></a>FastDfs安装</h3><h3 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">libfastcommon-1.0.48.tar.gz</span><br><span class="line">fastdfs-6.07.tar.gz</span><br><span class="line">libfastcommon-1.0.48.tar.gz</span><br><span class="line">fastdfs-6.07.tar.gz</span><br></pre></td></tr></table></figure><h3 id="安装gcc环境"><a href="#安装gcc环境" class="headerlink" title="安装gcc环境"></a>安装gcc环境</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y gcc gcc-c++</span><br></pre></td></tr></table></figure><h3 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">libfastcommon-1.0.48.tar.gz</span><br><span class="line">fastdfs-6.07.tar.gz</span><br><span class="line"><span class="comment"># 以上解压 ./make.sh &amp;&amp; ./make insatll</span></span><br></pre></td></tr></table></figure><p>安装好后会在**&#x2F;etc&#x2F;fdfs**有配置文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/fdfs</span><br><span class="line"><span class="built_in">cp</span> tracker.conf.sample tracker.conf</span><br><span class="line"><span class="built_in">cp</span> storage.conf.sample storage.conf</span><br><span class="line"><span class="built_in">cp</span> client.conf.sample client.conf <span class="comment">#客户端文件测试使用</span></span><br><span class="line"><span class="built_in">cp</span> /usr/local/src/java/fastdfs-6.07/conf/http.conf <span class="comment">#供nginx访问使用 </span></span><br><span class="line"><span class="built_in">cp</span> /usr/local/src/java/fastdfs-6.07/conf/mime.types ./ <span class="comment">#供nginx访问使用</span></span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#解压以下文件</span></span><br><span class="line">fastdfs-nginx-module-1.22.tar.gz</span><br><span class="line">nginx-1.15.4.tar.gz</span><br></pre></td></tr></table></figure><h3 id="配置Nginx模块"><a href="#配置Nginx模块" class="headerlink" title="配置Nginx模块"></a>配置Nginx模块</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd nginx-1.15.4</span><br><span class="line">./configure --add-module=/usr/local/src/java/fastdfs-nginx-module-1.22/src #添加模块</span><br><span class="line">make &amp;&amp; make insatll #安装ninx</span><br></pre></td></tr></table></figure><h3 id="配置tracker"><a href="#配置tracker" class="headerlink" title="配置tracker"></a>配置tracker</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建存储目录</span></span><br><span class="line">mkdir -m 777 /home/fds</span><br><span class="line">vim /etc/fdfs/tracker.conf</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改以下内容</span></span><br><span class="line">base_path = /home/dfs # 数据和日志文件存储根目录</span><br></pre></td></tr></table></figure><h3 id="配置storage"><a href="#配置storage" class="headerlink" title="配置storage"></a>配置storage</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/fdfs/storage.conf</span><br><span class="line"><span class="comment">#修改以下内容</span></span><br><span class="line">base_path=/home/dfs  <span class="comment"># 数据和日志文件存储根目录</span></span><br><span class="line">store_path0=/home/dfs  <span class="comment"># 第一个存储目录</span></span><br><span class="line">tracker_server=本机ip:22122  <span class="comment"># 本机ip改成自己服务器的ip</span></span><br><span class="line">http.server_port=8888  <span class="comment"># http访问文件的端口(默认8888,看情况修改,和nginx中保持一致)</span></span><br></pre></td></tr></table></figure><h3 id="启动tracker和storage"><a href="#启动tracker和storage" class="headerlink" title="启动tracker和storage"></a>启动tracker和storage</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fdfs_trackerd /etc/fdfs/tracker.conf</span><br><span class="line">fdfs_storaged /etc/fdfs/storage.conf</span><br><span class="line">netstat -unltp |grep fdfs</span><br></pre></td></tr></table></figure><h3 id="使用client测试"><a href="#使用client测试" class="headerlink" title="使用client测试"></a>使用client测试</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/fdfs/client.conf</span><br><span class="line">base_path=/home/dfs</span><br><span class="line">tracker_server=本机ip:22122    <span class="comment">#本机ip修改为服务器ip</span></span><br><span class="line">fdfs_upload_file /etc/fdfs/client.conf /usr/local/src/nginx-1.15.4.tar.gz</span><br><span class="line">保存后测试,返回ID表示成功 如：group1/M00/00/00/wKgogmNGNpGAdE87AA-itrfn0m4.tar.gz</span><br></pre></td></tr></table></figure><h3 id="配置nginx访问"><a href="#配置nginx访问" class="headerlink" title="配置nginx访问"></a>配置nginx访问</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/fdfs/mod_fastfds.conf</span><br><span class="line">tracker_server=本机ip:22122  <span class="comment">#本机ip修改为服务器ip</span></span><br><span class="line">url_have_group_name=<span class="literal">true</span></span><br><span class="line">store_path0=/home/dfs</span><br><span class="line"><span class="comment">#修改nginx配置</span></span><br><span class="line">vim /usr/local/src/java/nginx-1.15.4/conf/nginx.conf</span><br><span class="line">server &#123;</span><br><span class="line">    listen       8888;    <span class="comment">## 该端口为storage.conf中的http.server_port相同</span></span><br><span class="line">    server_name  localhost;</span><br><span class="line">    location ~/group[0-9]/ &#123;</span><br><span class="line">        ngx_fastdfs_module;</span><br><span class="line">    &#125;</span><br><span class="line">    error_page   500 502 503 504  /50x.html;</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">    root   html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#启动nginx</span></span><br><span class="line">/usr/local/nginx/sbin/nginx</span><br></pre></td></tr></table></figure><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">如果上传成功 但是nginx报错404 先检查mod_fastdfs.conf文件中的store_path0是否一致</span><br><span class="line">如果nginx无法访问 先检查防火墙 和 mod_fastdfs.conf文件tracker_server是否一致</span><br><span class="line">如果不是在/usr/local/src文件夹下安装 可能会编译出错</span><br><span class="line"></span><br><span class="line">上述ip地址可以写内网或者外网地址，切勿写127.0.0.1或者localhost</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fdfs_trackerd /etc/fdfs/tracker.conf</span><br><span class="line">fdfs_storaged /etc/fdfs/storage.conf</span><br><span class="line">/usr/local/nginx/sbin/nginx</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> FastDfs </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Docker 简单使用</title>
      <link href="/2022/09/12/Docker%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"/>
      <url>/2022/09/12/Docker%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="Linux防火墙"><a href="#Linux防火墙" class="headerlink" title="Linux防火墙"></a>Linux防火墙</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl status firewalld <span class="comment">#查看状态</span></span><br><span class="line">systemctl stop firewalld <span class="comment">#关闭</span></span><br><span class="line">systemclt <span class="built_in">disable</span> firewalld <span class="comment">#关闭开机自启</span></span><br></pre></td></tr></table></figure><h2 id="docker常用操作"><a href="#docker常用操作" class="headerlink" title="docker常用操作"></a>docker常用操作</h2><h3 id="docker安装"><a href="#docker安装" class="headerlink" title="docker安装"></a>docker安装</h3><p><a href="https://docs.docker.com/engine/install/#server">server安装</a></p><h3 id="docker开机自启"><a href="#docker开机自启" class="headerlink" title="docker开机自启"></a>docker开机自启</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> docker.service</span><br></pre></td></tr></table></figure><h3 id="容器开机自启"><a href="#容器开机自启" class="headerlink" title="容器开机自启"></a>容器开机自启</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--restart=always <span class="comment">#开机自启</span></span><br></pre></td></tr></table></figure><h3 id="安装RabbitMQ"><a href="#安装RabbitMQ" class="headerlink" title="安装RabbitMQ"></a>安装RabbitMQ</h3><blockquote><p>rabbitmq:management有管理界面</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull rabbitmq:management</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 5672:5672 -p 15672:15672 --name rabbitmq1 rabbitmq:management</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Docker </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Linux 学习笔记</title>
      <link href="/2022/07/15/Linux%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/2022/07/15/Linux%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h3 id="用户管理及组"><a href="#用户管理及组" class="headerlink" title="用户管理及组"></a>用户管理及组</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/etc/passwd         #用户账号文件</span><br><span class="line">/etc/shadow#用户影子文件</span><br><span class="line">/etc/group#用户组账号文件</span><br><span class="line">/etc/gshadow#用户组影子文件</span><br><span class="line">/etc/spool/mail#用户邮箱目录</span><br><span class="line">/etc/skel#用户模板目录</span><br><span class="line">/etc/default/useradd</span><br><span class="line">/etc/login.defs#用户默认配置</span><br></pre></td></tr></table></figure><h4 id="添加用户"><a href="#添加用户" class="headerlink" title="添加用户"></a>添加用户</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd [选项] 用户名</span><br></pre></td></tr></table></figure><p>选项：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-u 指定uid</span><br><span class="line"></span><br><span class="line">-g 指定初始组(尽量不使用)</span><br><span class="line"></span><br><span class="line">-G 指定附加组</span><br><span class="line"></span><br><span class="line">-c 添加说明</span><br><span class="line"></span><br><span class="line">-d 指定家目录</span><br><span class="line"></span><br><span class="line">-s shell /bin/bash</span><br></pre></td></tr></table></figure><h4 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userdel [-r] 用户名</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-r 删除用户同时删除该用户家目录</span><br></pre></td></tr></table></figure><h4 id="修改用户"><a href="#修改用户" class="headerlink" title="修改用户"></a>修改用户</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usermod [选项] 用户名</span><br></pre></td></tr></table></figure><p>选项:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-u UID：修改用户的UID</span><br><span class="line"></span><br><span class="line">-d家目录：修改用户的家目录。家目录必须写绝对路径</span><br><span class="line"></span><br><span class="line">-c用户说明：修改用户的说明信息，就是/etc/passwd文件的第五个字段</span><br><span class="line"></span><br><span class="line">-g 组名：修改用户的初始组，就是/etc/passwd文件的第四个字段</span><br><span class="line"></span><br><span class="line">-G 组名：修改用户的附加组，其实就是把用户加入其他用户组</span><br><span class="line"></span><br><span class="line">-s shell：修改用户的登录Shell。默认是/bin/bash</span><br><span class="line"></span><br><span class="line">-e 日期：修改用户的失效日期，格式为“YYYY-MM-DD”。也就是/etc/shadow文件的第八个字段</span><br><span class="line"></span><br><span class="line">-L：”临时锁定用户(Lock)</span><br><span class="line"></span><br><span class="line">-U：解锁用户(Unlock)</span><br></pre></td></tr></table></figure><h4 id="查询用户"><a href="#查询用户" class="headerlink" title="查询用户"></a>查询用户</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id 用户名</span><br></pre></td></tr></table></figure><h4 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd [选项] 用户名</span><br></pre></td></tr></table></figure><p>选项：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-l 暂时锁定用户(仅root使用)</span><br><span class="line"></span><br><span class="line">-u 解锁用户(仅root使用)</span><br><span class="line"></span><br><span class="line">注 : 不加用户名即给当前用户修改密码</span><br></pre></td></tr></table></figure><h4 id="切换用户"><a href="#切换用户" class="headerlink" title="切换用户"></a>切换用户</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">su [选项] 用户名</span><br><span class="line">su -c &quot;ls /home&quot; 用户名</span><br><span class="line">su - 用户名</span><br></pre></td></tr></table></figure><p>选项：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- 用户环境变量一起切换</span><br><span class="line"></span><br><span class="line">-c 仅执行一次命令,不切换身份 </span><br><span class="line"></span><br><span class="line"> <span class="built_in">exit</span>,<span class="built_in">logout</span>注销退到上个用户</span><br></pre></td></tr></table></figure><h4 id="创建用户组"><a href="#创建用户组" class="headerlink" title="创建用户组"></a>创建用户组</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupadd [选项] 组名</span><br></pre></td></tr></table></figure><p>选项</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-g 指定组<span class="built_in">id</span></span><br></pre></td></tr></table></figure><h4 id="删除用户组"><a href="#删除用户组" class="headerlink" title="删除用户组"></a>删除用户组</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupdel [选项] 组名</span><br></pre></td></tr></table></figure><h4 id="把用户添加进组或从组中删除"><a href="#把用户添加进组或从组中删除" class="headerlink" title="把用户添加进组或从组中删除"></a>把用户添加进组或从组中删除</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpasswd [选项] 组名</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">选项:</span><br><span class="line"></span><br><span class="line"> -a 用户名：把用户加入组</span><br><span class="line"></span><br><span class="line">-d 用户名：把用户从组中删除</span><br></pre></td></tr></table></figure><h3 id="文件管理"><a href="#文件管理" class="headerlink" title="文件管理"></a>文件管理</h3><p>在Linux系统上，<strong>一切皆文件</strong>，任何软件和I&#x2F;O设备都被视为文件。Linux中文件名最大支持<strong>256</strong>个字符，可以分别用A-Z，a-z，0-9等字符来命名，与Windows不同，Linux中文件名是<strong>区分大小写</strong>的。Linux系统中的文件是否能被执行，与扩展名没有关系，主要看<strong>文件的属性</strong></p><p>普通文件：最常使用的一类文件，用于存放数据、程序等信息的文件，如图形文件、声音文件、文档文件等，使用 ls -l 命令后，<strong>第一列第一个字符</strong>为“-”的文件为普通文件，普通文件一般为灰色字体，绿色字体的是可执行文件，红色字体的是压缩文件</p><p>目录文件：Linux内核组织文件系统的基本节点，存放文件名及其相关信息的文件，包含下一级目录或普通文件</p><p>设备文件：Linux将所有的外设都看作一种特殊的文件，用户通过文件访问设备，简化用户操作。根据访问数据方式的不同又分为<strong>块设备</strong>文件和<strong>字符设备</strong>文件。</p><p>链接文件：指向一个真实存在的文件，为解决文件的共享使用引入链接机制。顺带隐藏文件路径及节省存储等好处。链接分为<strong>硬链接</strong>和<strong>软链接</strong>。</p><p>管道文件：用于进程间传递数据的文件，主要作用是将前一个命令的标准输出作为后一个命令的标准输入，通常管道建立在调整缓存中。管道分为<strong>无名管道</strong>和<strong>有名管道</strong>，管道符“|”</p><h4 id="主要命令"><a href="#主要命令" class="headerlink" title="主要命令"></a>主要命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">pwd  #显示当前工作目录的路径(绝对路径)</span><br><span class="line">cd   #改变当前工作目录</span><br><span class="line">rmdir [-p] #删除目录 -p 递归删除目录，当子目录删除后其父目录为空时，也一同被删除</span><br><span class="line">touch 文件  #创建文件 </span><br><span class="line">cat [选项] 文件名 #只读显示查看文件内容 -b 显示行号,空白不显示 -n 显示行号,包括空白行</span><br><span class="line">more  [选项] 文件名 #分页查看文件 -c 显示下一屏之前先清屏 -d 每屏底部显示“—more--（xx%）”等友好提示信息 -s 文件中的连续空白行压缩诚一个空白行显示 空格下一页 b上一页</span><br><span class="line">less [选项] 文件名 #选项与more类似 按空格键向下翻动一页，上/下方向键向上/下回翻，按q键则退出查看</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"> <span class="comment">#输出重定向：会将原来的文件的内容覆盖</span></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;   <span class="comment">#追加：不会覆盖原来文件的内容，而是追加到文件的尾部</span></span></span><br><span class="line">cal [-y] #显示当月日历   -y 当前年日历   </span><br><span class="line">echo #输出</span><br><span class="line">Locate 搜索文件 #由于locate指令基于数据库进行查询，所以第一次运行前，必须使用 updatedb指令创建 locate数据库</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">管道符’|<span class="string">&#x27;，表示将前一个命令的处理结果输出传递给后面的命令处理 手册文档 man</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls [选项] [文件/目录] #列出目录内容</span><br></pre></td></tr></table></figure><table><thead><tr><th><strong>选项</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td>-a</td><td>显示目录下的所有文件信息，包含以.开头的隐含文件</td></tr><tr><td>-A</td><td>显示目录下的所有文件信息，包含以.开头的隐含文件，但不列出”.”和”..”</td></tr><tr><td>-d</td><td>显示目录本身的信息，而非目录下的文件信息</td></tr><tr><td>-l</td><td>长格式显示详细信息，该选项最常用</td></tr><tr><td>-h</td><td>人性化显示容量信息</td></tr><tr><td>-t</td><td>以修改时间排序，默认按文件名称排序</td></tr><tr><td>-c</td><td>显示文件或目录属性最后修改时间</td></tr><tr><td>-u</td><td>显示文件或目录最后被访问的时间</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir [选项] 目录名称</span><br></pre></td></tr></table></figure><table><thead><tr><th align="center"><strong>选项</strong></th><th align="left"><strong>描述</strong></th></tr></thead><tbody><tr><td align="center">-m</td><td align="left">设定目录权限，类似chmod</td></tr><tr><td align="center">-p</td><td align="left">创建多级目录</td></tr><tr><td align="center">-v</td><td align="left">每次创建新目录都显示信息</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm [选项]  文件/目录</span><br></pre></td></tr></table></figure><table><thead><tr><th><strong>选项</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td>-i</td><td>进行交互式删除，删除时提示用户输入“y”确认</td></tr><tr><td>-f</td><td>强制删除，不给出相应提示</td></tr><tr><td>-r</td><td>递归地删除整个目录</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp [选项]  源文件/目录  目标文件/目录</span><br></pre></td></tr></table></figure><table><thead><tr><th align="center"><strong>选项</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td align="center">-a</td><td>递归地将源文件或目录中的内容都复制到目标目录，并保留文件属性及链接不变</td></tr><tr><td align="center">-d</td><td>复制时保留文件链接</td></tr><tr><td align="center">-f</td><td>强制复制，在覆盖已经存在的目标文件时，不给出提示（系统默认设置）</td></tr><tr><td align="center">-i</td><td>交互式复制，在覆盖目标文件</td></tr><tr><td align="center">-p</td><td>除复制源文件内容外，还复制修改时间和访问权限</td></tr><tr><td align="center">-r</td><td>若源文件是个目录，则递归将目录中的文件复制倒目标目录，此时目标必须是个目录</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv [选项]  源文件/目录  目标文件/目录</span><br></pre></td></tr></table></figure><table><thead><tr><th><strong>选项</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td>-i</td><td>交互式操作，若目标文件或目录有与源文件或目录同名的，则要求确认</td></tr><tr><td>-f</td><td>强制操作，若目标文件或目录与源文件或目录同名，则直接覆盖现有的文件或目录</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">date #显示当前日期</span><br><span class="line">date -s &quot;&quot; #设置日期</span><br><span class="line">date &quot;+%Y-%m-%d:%H:%M:%S&quot;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find [路径] [选项] </span><br></pre></td></tr></table></figure><table><thead><tr><th><strong>选项</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td>-name</td><td>查找文件名匹配所给字串的所有文件，字串内可用通配符</td></tr><tr><td>-type</td><td>按文件类型查找，文件(f)、目录(d)、设备(b,c)、链接(l)等</td></tr><tr><td>-user</td><td>按文件属主查找</td></tr><tr><td>-exec</td><td>对找到的文件执行命令，后接Linux命令</td></tr><tr><td>-a</td><td>逻辑与</td></tr><tr><td>-o</td><td>逻辑或</td></tr><tr><td>！</td><td>逻辑非</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grep [选项] 匹配模式 文件名 </span><br><span class="line">grep -ni yes /temp/a.txt 过滤出包含yes的行</span><br></pre></td></tr></table></figure><table><thead><tr><th><strong>选项</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td>-i</td><td>忽略字符大小写</td></tr><tr><td>-v</td><td>取反匹配，显示不包含匹配文本的所有行</td></tr><tr><td>-w</td><td>匹配单词</td></tr><tr><td>–color</td><td>显示颜色</td></tr></tbody></table><h4 id="文件或目录权限"><a href="#文件或目录权限" class="headerlink" title="文件或目录权限"></a>文件或目录权限</h4><h5 id="访问权限"><a href="#访问权限" class="headerlink" title="访问权限"></a>访问权限</h5><p><strong>文件访问者</strong>：用户(u)、组(g)、其他(o)</p><p><strong>访问权限</strong>：只读(r&#x3D;4)、写(w&#x3D;2)、执行(x&#x3D;1)</p><p>-rwxrwxrwx  类型用户组其他</p><table><thead><tr><th><strong>字符</strong></th><th><strong>文件类型</strong></th></tr></thead><tbody><tr><td>-</td><td>普通文件</td></tr><tr><td>d</td><td>目录文件</td></tr><tr><td>l</td><td>链接文件</td></tr><tr><td>b</td><td>块设备文件</td></tr><tr><td>c</td><td>字符设备文件</td></tr><tr><td>p</td><td>管道文件</td></tr><tr><td>s</td><td>套接字文件</td></tr></tbody></table><h5 id="修改权限"><a href="#修改权限" class="headerlink" title="修改权限"></a>修改权限</h5><p><strong>修改权限</strong> chmod</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod [选项] [模式] 目录文件名称</span><br></pre></td></tr></table></figure><ol><li><p>+、-、&#x3D; 变更权限 </p><p>u：所有者  g：所有组   o：其他人  a：所有人（u、g、o的总和）</p><p>   <strong>chmod</strong> u&#x3D;rwx,g&#x3D;rx,o&#x3D;rx abc</p><p>   <strong>chmod</strong> u-x,g+w abc</p></li><li><p>通过数字变更</p><p><strong>chmod</strong> 755 abc.txt</p></li></ol><p><strong>更改文件或目录所有权</strong> chown</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chown [选项] 用户名 文件或目录</span><br><span class="line">-R #如果是目录则使其下所有子文件或目录递归生效，即一次修改某个目录下所有文件的所有者</span><br></pre></td></tr></table></figure><p>chown newowner file 改变文件的所有者</p><p>chown newowner:newgroup file 改变用户的所有者和所有组</p><p><strong>修改文件或目录所在组</strong> chgrp</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chgrp newgroup file</span><br><span class="line">-R #如果是目录则使其下所有子文件或目录递归生效，即一次修改某个目录下所有文件的所有者</span><br></pre></td></tr></table></figure><p><strong>文件默认权限</strong> umask掩码</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">用八进制数显示<span class="built_in">umask</span>权限：<span class="built_in">umask</span></span><br><span class="line">更改<span class="built_in">umask</span> <span class="built_in">umask</span> 027</span><br><span class="line">文件创建时的默认权限=0666-<span class="built_in">umask</span></span><br><span class="line">目录创建时的默认权限=0777-<span class="built_in">umask</span></span><br><span class="line">单纯计算不准确 可以通过字母符号计算</span><br></pre></td></tr></table></figure><p><strong>文件特殊权限SUID、SGID、Dticky BIT</strong></p><p><strong>SUID</strong> 4 命令执行者要拥有执行权限 在执行该程序是获取程序所属主的身份 执行过程中有效 如passwd,</p><p><strong>SGID</strong> 2 只有可执行的二进制程序才可设置 类似<em><strong>SUIFD</strong></em>不同的是 还要拥有读权限 组升级为程序所属组的身份</p><p><strong>SBIT</strong> 1 仅对目录有效 普通用户对目录拥有wx权限 即有写入权限 除root用户也可以删改其他用户的文件所以需要<em><strong>BIT粘着位</strong></em>  限制对该目录有写权限的只能删改自己建立的文件</p><p>例:chmod 4755 abc.txt</p><h4 id="文件打包及压缩"><a href="#文件打包及压缩" class="headerlink" title="文件打包及压缩"></a>文件打包及压缩</h4><p><strong>zip&#x2F;unzip</strong> zip用于压缩 unzip解压 .zip</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zip [选项] 压缩包名 源文件和源目录 #-r 递归压缩</span><br><span class="line">unzip [选项] 压缩包名 # -d 指定解压文件存放目录</span><br></pre></td></tr></table></figure><p><strong>gzip&#x2F;ungzip</strong> gzip压缩后不保留原来文件 .gz 只能逐个生成压缩文件无法打包目录和将多个文件打包成一个文件所以经常和tar一起使用</p><p><strong>bzip2&#x2F;unbzip2</strong> .bz2</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bzip2 [选项] 源文件</span><br><span class="line">-d #解压缩</span><br><span class="line">-k #压缩保留源文件</span><br><span class="line">-v #显示压缩详细信息</span><br></pre></td></tr></table></figure><p><strong>tar打包</strong> 非压缩命令，通常保存文件先用tar将目录或文件打成tar归档文件，再用gzip或bzip2压缩，最后打包后的文件是 tar.gz结尾的文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tar [选项] 打包的内容</span><br><span class="line">-c :打包</span><br><span class="line">-x :解打包</span><br><span class="line">-f :指定压缩包的文件名</span><br><span class="line">-v :显示解打包文件过程</span><br><span class="line">-t :测试，就是不解打包，只是查看包中有哪些文件</span><br><span class="line">-C 目录：指定解打包的位置</span><br></pre></td></tr></table></figure><p><strong>tar打包压缩</strong>  .tar.gz&#x2F;.tar.bz2</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-z：压缩和解压缩&quot;.tar.gz&quot;格式</span><br><span class="line">-j：压缩和解压缩”.tar.bz2&quot;格式</span><br></pre></td></tr></table></figure><h3 id="磁盘管理"><a href="#磁盘管理" class="headerlink" title="磁盘管理"></a>磁盘管理</h3><h4 id="磁盘分区类型"><a href="#磁盘分区类型" class="headerlink" title="磁盘分区类型"></a>磁盘分区类型</h4><ol><li><strong>主分区</strong>：分区信息存储在主引导记录扇区的分区表中，叫主分区，也叫引导分区，一般操作系统安装在这个分区中，这样才能保证开机自动进入系统，一块硬盘，创建至少1个、最多4个主分区，当创建完4个主分区后，就无法再创建扩展分区和逻辑分区了。</li><li><strong>扩展分区</strong>: 扩展分区是一个概念，实际在硬盘中是看不到的，也无法直接使用扩展分区，除了主分区外，剩余的磁盘空间就是扩展分区了。一块硬盘，没有或者最多1个扩展分区。扩展分区可以继续进行扩展切割分为若干<strong>逻辑分区</strong></li><li><strong>逻辑分区</strong>：在扩展分区上面，可以创建多个逻辑分区。每一个逻辑分区都可以存储一个文件系统。</li></ol><p><strong>磁盘分区文件命名规则：</strong> &#x2F;dev&#x2F;**</p><p>Linux给IDE磁盘分配了一个由hd前缀组成的文件，SCSI磁盘则被分配由sd前缀组成的文件，USB接口的移动磁盘通常会被识别为SCSI，因此也是以sd开头</p><p><strong>lsblk -f</strong>  查看当前系统分区情况</p><h4 id="常用磁盘管理命令"><a href="#常用磁盘管理命令" class="headerlink" title="常用磁盘管理命令"></a><strong>常用磁盘管理命令</strong></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mount [选项] 设备名 挂载点 #用于挂载指定的文件系统</span><br><span class="line">-a   安装在/etc/fstab文件中列出的所有文件系统(自动挂载)   -r   将文件系统安装为只读。           </span><br><span class="line">-w  将文件系统安装为可写，为命令默认情况。       </span><br><span class="line">-t   指定设备的文件系统类型</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">挂载点必须是一个已经存在的目录，这个目录可以不为空，但挂载后，这个目录下以前的内容将不可用，umount以后会恢复正常</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">umount [device]/[dir]</span><br><span class="line">-a：卸载/etc/mtab中记录的所有文件系统</span><br><span class="line">-h：显示帮助信息并退出</span><br><span class="line">-r：若无法成功卸载，则尝试以只读的方式重新挂入文件系统</span><br><span class="line">-v：执行时显示详细的信息</span><br><span class="line">-V：显示版本信息</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fdisk #能划分磁盘成为若干个区，同时也能为每个分区指定分区的文件系统</span><br><span class="line">fdisk –l #列出所有的分区,包括没有挂上的分区和usb设备</span><br><span class="line">fdisk -l  /dev/hda1 #查看单个硬盘情况</span><br><span class="line">fdisk 设备：fdisk 命令操作磁盘</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkfs #分区格式化</span><br><span class="line">mkfs [选项] 设备</span><br><span class="line">-t：定义创建的文件系统类型，默认为Ext2</span><br><span class="line">-c：在创建文件系统前检查设备坏块</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">例 mkfs –t ext4 /dev/sda1</span>  </span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">du [选项] 文件/目录 #统计文件和目录占用磁盘空间情况</span><br><span class="line">-h： 输出文件系统分区使用的情况，例如：10KB，10MB，10GB等</span><br><span class="line">-s： 显示文件或整个目录的大小，默认单位是KB</span><br><span class="line">-c： 在显示结果后面添加一个总计（系统默认设置）</span><br><span class="line">-a： 显示所有文件及其子目录占用的数据块数</span><br><span class="line">df [选项] #磁盘空间统计</span><br><span class="line">-a： 显示所有文件系统的信息，包括swap和/proc           </span><br><span class="line">-h： 以最适合的容量单位显示</span><br><span class="line">-i:    显示文件节点数inode的使用情况而不是文件块的使用情况</span><br><span class="line">-l： 只显示本地系统的使用情况</span><br></pre></td></tr></table></figure><h4 id="虚拟机添加硬盘"><a href="#虚拟机添加硬盘" class="headerlink" title="虚拟机添加硬盘"></a>虚拟机添加硬盘</h4><p>添加硬盘(虚拟机-&gt;设置-&gt;硬盘-&gt;默认)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">lsblk -f #显示磁盘信息</span><br><span class="line">fdisk /dev/sdb #对磁盘进行分区</span><br><span class="line"> -m #提示</span><br><span class="line"> -w #保存修改</span><br><span class="line">mkfs -t ext4 /dev/sdb1 #格式化</span><br><span class="line">mkdir -m 777 /mnt/newdisk</span><br><span class="line">mount /dev/sdb1 /mnt/newdisk #临时生效</span><br><span class="line">vim /etc/fstab#写入到该文件永久生效</span><br><span class="line">/dev/sdbl                 /mnt/newdisk1      ext4     0  0</span><br><span class="line">mount -a #/etc/fstab立即生效</span><br></pre></td></tr></table></figure><p><strong>删除永久生效</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/fstab #删除配置的行:wq</span><br><span class="line">df -h 查看挂载信息 #umount</span><br><span class="line">fdisk </span><br><span class="line">-d #删除对应分区 -w</span><br><span class="line">lsblk -f#查看是否成功</span><br><span class="line">虚拟机软件移除硬盘</span><br></pre></td></tr></table></figure><h4 id="磁盘配额管理"><a href="#磁盘配额管理" class="headerlink" title="磁盘配额管理"></a>磁盘配额管理</h4><p><strong>soft</strong>：软限制，也称为最低容量限制。使用者在宽限时间之内，他的容量可以超过最低容量限制，但必须在宽限时间之内将磁盘容量降低到最低容量的限制之下</p><p><strong>hard</strong>：硬限制，也称为最高容量限制，是绝对不能超过的容量，最高容量限制要比最低容量限制大</p><p><strong>宽限容量</strong>：soft到hard之间的容量就是宽限容量</p><p><strong>宽限时间</strong>：当使用者使用的空间超过了软限制，却还没有到达硬限制时，那么在这个宽限时间之内就必须请使用者将使用的磁盘容量降低到软限制之下，而当时用者的磁盘容量使用情况超过软限制时，宽限时间就会自动被启动，而在使用者将容量降低到软限制之下后，宽限时间就会自动的取消</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">quota [-uvsl] [username]</span><br><span class="line">quota [-gvsl] [groupname]#查看磁盘空间使用情况</span><br><span class="line">-u：后面可以接 username，表示列出该用户的磁盘配额限制值；如果不接用用名，表示显示出执行者的磁盘配额限制值</span><br><span class="line">-g：后面可接groupname，表示显示出该群组的磁盘配置限制值</span><br><span class="line">-v：显示每个 filesystem的磁盘配额值 </span><br><span class="line">-s：可选择以inode或磁盘容量的限制值来显示</span><br><span class="line">-1：仅显示出目前本机上面的 filesystem的磁盘配额值</span><br><span class="line"></span><br><span class="line">quotacheck [-avug][/mount_ point]#创建磁盘配额文件</span><br><span class="line">-a：扫瞄所有在/etc/mtab内含有磁盘配额支持的filesystem，加上此参数后， /mount_point可不必写，因为它会扫描所有的文件系统</span><br><span class="line">-u：针对使用者扫描档案与目录的使用情况，会建立aquota. user</span><br><span class="line">-g：针对群组扫描档案与目录的使用情况，会建立aquota. group</span><br><span class="line">-V：显示扫描过程的信息；</span><br><span class="line">-M：强制进行quotacheck的扫描</span><br><span class="line">      </span><br><span class="line">edquota [-u username] [-g groupname] #对用户或者用户组设置磁盘配额</span><br><span class="line">edquota  -t      #修改限制时间</span><br><span class="line">edquota  -p username_demo -u username   #复制配额</span><br><span class="line">-u：后接账号名称。可以进入磁盘配额的编辑画面去设定username的限制值； </span><br><span class="line">-g：后接群组名称。可以进入磁盘配额的编辑画面去设定groupname的限制值； </span><br><span class="line">-t： 可以修改宽限时间（就是超过磁盘配额的 soft limit值后，还能使用硬盘的宽限期限）</span><br><span class="line">-p：复制范本。 username_demo为已经存在并且已设定好磁盘配额的使用者，那么将 username_demo这个人的磁盘配额限制值复制给 Username</span><br><span class="line"></span><br><span class="line">quotaon [-avug] [/mount_ point] #启动磁盘配额</span><br><span class="line">-u：针对使用者启动磁盘配额（aquota.user）</span><br><span class="line">-g：针对群组启动磁盘配额（aquota.group）</span><br><span class="line">-v：显示启动过程的相关讯息； </span><br><span class="line">-a：根据/etc/mtab内的文件系统设定启动有关的磁盘配额，若不加-a的话，则后面就需要加上特定的分区名    </span><br><span class="line"></span><br><span class="line">quotaoff [-avug] [/mount _point] #关闭磁盘配额</span><br><span class="line">-a：依据/etc/mtab文件关闭配额分区</span><br><span class="line">-u：关闭用户的磁盘空间限制</span><br><span class="line">-g：关闭群组的磁盘空间限制</span><br><span class="line">-v：显示指令执行过程</span><br><span class="line"></span><br><span class="line">repquota [-avug] [文件系统…]</span><br><span class="line">-a：直接到/etc/mtab搜寻具有磁盘配额标志的文件系统，并报告磁盘配额的结果；</span><br><span class="line">-v：输出所有的磁盘配额结果；而非仅下达指令者自己的磁盘配额限值；</span><br><span class="line">-u：显示出使用者的磁盘配额限值（这是默认值）；</span><br><span class="line">-g：显示出个别群组的磁盘配额限值</span><br><span class="line">执行repquota指令，可报告磁盘空间限制的状况，清楚得知每位用户或每个群组已使用多少空间</span><br></pre></td></tr></table></figure><p><strong>配额步骤</strong></p><p>1）设定分区的文件系统支持磁盘配额参数：由于磁盘配额必须要让文件系统支持才行，而支持度最好的文件系统是ext2&#x2F;ext3，所以磁盘配额的文件系统最好设置为ext2&#x2F;ext3，启动文件系统支持磁盘，最简单的就是编辑&#x2F;etc&#x2F;fstab，使得准备要开放的磁盘可以支持磁盘配额。（添加参数）defaults,<strong>usrquota</strong>,<strong>grpquota</strong></p><p>2）建立磁盘配额记录文件：整个磁盘配额进行磁盘限制值记录的档案是 aquota. user&#x2F;aguota.group，这两个文件必须利用 quotacheck扫描才行，所以，接下来的步骤就是用 quotacheck来扫描。quotacheck -avgu</p><p>3）编辑磁盘配额限制值数据：使用 edquota来编辑每个使用者或群组的可使用空间 edquota -u username&#x2F;edquota -g groupname</p><p>4）重新扫描与启动磁盘配额：设定好了磁盘配额之后，建议再进行一次quotacheck，然后再以quotaon来启动（关闭 磁盘配额用quotaoff ）</p><h3 id="软件包管理"><a href="#软件包管理" class="headerlink" title="软件包管理"></a>软件包管理</h3><p><strong>RPM包</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh 包全名</span><br><span class="line">-i                   #install安装（ install）</span><br><span class="line">-v                  #显示更详细的信息（ verbose）</span><br><span class="line">-h                  #打印显示安装进度</span><br><span class="line">-U #升级安装，如果没有安装过，系统直接安装。如果安装过的版本较旧，则升级到新版本</span><br><span class="line">-F：#升级安装，如果没有安装过，则不会安装。必须安装有较旧版本，才能升级</span><br><span class="line">-e #卸载</span><br><span class="line">--nodeps    #不检测依赖性安装</span><br><span class="line">--replacefiles   #替换文件安装</span><br><span class="line">--replacepkgs   #替换软件包安装</span><br><span class="line">--force  #强制安装</span><br><span class="line">--test   #测试安装</span><br><span class="line">--prefix   #指定安装路径(不建议)</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rpm -q 包名</span><br><span class="line">-q #(查询)query</span><br><span class="line">-a #所有已安装</span><br><span class="line">-i #查看某软件包信息</span><br><span class="line">-p #查询没有安装的软件包(package)</span><br><span class="line">-l #列出软件包的文件列表和打算安装位置</span><br><span class="line">-f #查询文件属于哪个软件包(file) rpm -qf 文件名</span><br></pre></td></tr></table></figure><h3 id="Vim基本操作"><a href="#Vim基本操作" class="headerlink" title="Vim基本操作"></a>Vim基本操作</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">hjkl #左下上右</span><br><span class="line">a/A #在光标所在字符后插入/在光标所在行尾</span><br><span class="line">i/I #在光标前插入/在光标所在行首插入</span><br><span class="line">o/O #在光标下插入新行/上插入新行</span><br><span class="line">^ #移到行首</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="comment">#移到行尾</span></span></span><br><span class="line">gg #移动到文件头</span><br><span class="line">G #移动到文件的最后一行的行头</span><br><span class="line">:n #移动到第几n行</span><br><span class="line">x #删除单个字母</span><br><span class="line">nx #删除n个字母</span><br><span class="line">dd #删除单行</span><br><span class="line">ndd #删除多行</span><br><span class="line">:n1,n2d #删除指定范围的行 (10,20d,删除10到20行)</span><br><span class="line">p #粘贴到光标后</span><br><span class="line">P #粘贴到光标前</span><br><span class="line">dG #从光标所在行删除到文件尾</span><br><span class="line">yy #复制单行</span><br><span class="line">nyy #复制n行</span><br><span class="line">u #撤销</span><br><span class="line">ctrl+r #反撤销</span><br><span class="line">r R #r:替换光标所在处字符 R:从光标处开始替换</span><br><span class="line">/查找内容</span><br><span class="line">?查找内容 #n:下一个 N:上一个</span><br><span class="line">:1,10s/old/new/g #替换1到10行中所有的old为new</span><br><span class="line">:%s/old/new/g #替换文件中的old为new</span><br><span class="line">:r 文件名 #把文件内容导入光标位置</span><br><span class="line">:! 命令 #vim中执行系统命令</span><br><span class="line">:r !命令 #在vim中执行系统命令，并把命令结果导入光标所在行</span><br><span class="line">:ab 源字符 替换后字符 #字符替换</span><br><span class="line">vim -o  文件1  文件2 #多文件打开</span><br><span class="line">      -o（小写o）    会上下分屏打开两个文件，通过先按“ctrl+w”，再按“上下箭头”的方式在两个文件之间切换</span><br><span class="line">     -0（大写0）      会左右分屏打开两个文件，通过先按“ctr1+w”，再按“左右箭头”的方式在两个文件之间切换</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">:set nu/nonu #显示与取消行号</span><br><span class="line">:syntax on/off #语法高亮</span><br><span class="line">:set hlsearch/nohlsearch #查找字符串高亮显示</span><br><span class="line">:set ruler/noruler #显示右下角的状态栏</span><br><span class="line">:set showmode/noshowmode #显示左下角</span><br><span class="line">:set list/nolist #是否显示隐藏字符</span><br></pre></td></tr></table></figure><h3 id="shell编程"><a href="#shell编程" class="headerlink" title="shell编程"></a>shell编程</h3><h4 id="shell基础"><a href="#shell基础" class="headerlink" title="shell基础"></a>shell基础</h4><h5 id="常用快捷键"><a href="#常用快捷键" class="headerlink" title="常用快捷键"></a>常用快捷键</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ctrl+A #把光标移动到命令行开头</span><br><span class="line">ctrl+E #把光标移动到命令行结尾</span><br><span class="line">ctrl+C #强制终止当前命令</span><br><span class="line">ctrl+L #清理屏幕</span><br><span class="line">ctrl+U #剪切或删除光标之前的命令</span><br><span class="line">ctrl+K #剪切或删除光标之后的命令</span><br><span class="line">ctrl+Y #粘贴剪切的内容</span><br><span class="line">ctrl+R #在历史命令中搜索界面</span><br><span class="line">ctrl+D #退出当前终端</span><br><span class="line">ctrl+Z #暂停并放入后台</span><br><span class="line">ctrl+S #暂停屏幕输出</span><br><span class="line">ctrl+Q #恢复屏幕输出</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/shells #查看当前系统支持的shell</span><br><span class="line">tcsh --version  #查看当前shell的版本号</span><br><span class="line">./A.sh #相对路径执行</span><br><span class="line">/root/sh/A.sh #绝对路径执行</span><br><span class="line">sh A.sh #sh 脚本名 参数 </span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo [选项] [输出内容]</span><br><span class="line">-e #支持反斜线控制的字符转换</span><br><span class="line">-n #取消输出后文末的换行符号(即默认是换行的)</span><br></pre></td></tr></table></figure><h5 id="历史命令"><a href="#历史命令" class="headerlink" title="历史命令"></a>历史命令</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">history [选项] [历史命令保存文件]</span><br></pre></td></tr></table></figure><table><thead><tr><th><strong>命令</strong></th><th><strong>功能描述</strong></th></tr></thead><tbody><tr><td>history</td><td>显示全部历史命令记录</td></tr><tr><td>history n</td><td>n 为数字，显示之前执行过的n条命令</td></tr><tr><td>history –c</td><td>清空所有的历史命令</td></tr><tr><td>history –w</td><td>将历史命令记录写入列表中（用户目录下的.bash_history文件）</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">!n #重复执行历史上的第n条命令</span><br><span class="line">!! #重复执行上一条命令</span><br><span class="line">!字符串 #重复执行最后一条以该字串凯开头的命令</span><br><span class="line">!$ #重复上一条命令的最后一个参数</span><br></pre></td></tr></table></figure><h5 id="起别名"><a href="#起别名" class="headerlink" title="起别名"></a>起别名</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alias #查询命令别名</span><br><span class="line">alias 别名=原命令 #设定命令别名</span><br><span class="line">ubalias vi #取消别名</span><br></pre></td></tr></table></figure><p>第一顺位执行用<strong>绝对路径或相对路径</strong>执行的命令</p><p>第二顺位执行<strong>别名</strong></p><p>第三顺位执行<strong>Bash的内部命令</strong></p><p>第四顺位执行按照**$PATH**环境变量定义的目录查找顺序找到的第一个命令</p><p>为了让这个别名永久生效，可以把别名写入环境变量配置文件“**~&#x2F;.** <strong>bashrc</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wc [选项] [文件名称]</span><br><span class="line">-c  #统计字节数</span><br><span class="line">-w  #统计单词数</span><br><span class="line">-l  #统计行数</span><br></pre></td></tr></table></figure><h5 id="多命令执行"><a href="#多命令执行" class="headerlink" title="多命令执行"></a>多命令执行</h5><p><strong>分号</strong>：ls ;dsad;dasd;ll              顺序执行</p><p><strong>逻辑与</strong>：ls &amp;&amp; date  lssa &amp;&amp; date    #&amp;&amp;前true继续执行&amp;&amp;后命令</p><p><strong>逻辑或</strong>：ls ||date    lssdas || date   #||前为false才执行后面</p><h5 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h5><p><strong>变量</strong>: 变量名称可以由<strong>字母</strong>、<strong>数字</strong>和<strong>下划线</strong>组成，但是<strong>不能以数字开头</strong>，变量的默认类型都是字符串型，如果要进行数值运算，则必须指定变量类型为<strong>数值型</strong></p><p>变量用等号连接值，等号左右两侧不能有空格</p><p>用户自定义变量、环境变量、位置参数变量、预定义变量</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">set [选项]</span><br><span class="line">-u #调用未声明变量会报错</span><br><span class="line">-x #在命令执行之前会把命令先输出一次</span><br><span class="line">  </span><br><span class="line">set 变量名 #变量的查看</span><br><span class="line">unset 变量名 #删除变量</span><br><span class="line">export 变量名 #设置环境变量 使用大写字母</span><br><span class="line">env #在终端查看环境变量</span><br><span class="line">export #在终端显示环境变量列表</span><br></pre></td></tr></table></figure><p>位置参数变量</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">n <span class="comment">#n为数字 0代表命令本身 1-9代表第一个到第九个参数 10以上要&#123;&#125; $&#123;11&#125;</span></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">* <span class="comment">#变量代表命令行的所有的参数,一个整体</span></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">@ <span class="comment">#变量代表命令行的所有的参数,每个参数分别对待</span></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash"><span class="comment"># #所有参数的个数</span></span></span><br></pre></td></tr></table></figure><p><em><em>$</em> 和 $@区别</em><em>:<strong>$</strong></em> for循环1次 ***@** for循环参数个数次</p><p>预定义变量</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">? <span class="comment">#最后一次执行的命令的返回状态,为0证明上一个命令正确，非0则不正确</span></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">$ <span class="comment">#当前进程的pid</span></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">! <span class="comment">#后台运行的最后一个进程的pid</span></span></span><br></pre></td></tr></table></figure><p>数组，就是<strong>相同数据类型</strong>的元素按一定顺序排列的集合，就是把有限个类型相同的变量用一个名字命名，然后用编号区分他们的变量的集合，这个名字称为<strong>数组名</strong>，编号称为<strong>下标</strong>。组成数组的各个变量成为数组的<strong>分量</strong>，也称为数组的<strong>元素</strong>，有时也称为下标变量</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;name&#125; <span class="comment">#输出数组第一个元素</span></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;name[0]&#125;</span> </span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;name[*]&#125; <span class="comment">#输出数组所有元素</span></span></span><br></pre></td></tr></table></figure><h5 id="接收键盘输入"><a href="#接收键盘输入" class="headerlink" title="接收键盘输入"></a>接收键盘输入</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">read [选项] [变量名]</span><br><span class="line">-p #提示信息 等待read输入时，输出提示信息</span><br><span class="line">-t #秒数 read命令会一直等待用户输入，使用该选项可以指定等待时间</span><br><span class="line">-n #字符数 read只接收指定的字符数就会执行</span><br><span class="line">-s #隐藏输入的数据</span><br></pre></td></tr></table></figure><p>变量名如果不指定会把输入保存入默认变量REPLY，如果只提供了一个变量名，则整个输入行赋予该变量，如果提供了一个以上的变量名，则输入行分为若干个字，一个接一个地赋予各个变量，而命令行上的最后一个变量取得剩余的所有字</p><h5 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">declare [+/-] [选项] 变量名</span><br><span class="line">-：#给变量设定类型属性</span><br><span class="line">+：#取消变量的类型属性</span><br><span class="line">a：#将变量声明为数组型</span><br><span class="line">i：#将变量声明为整数型（ integer）</span><br><span class="line">r：将变量声明为只读变量。注意，一旦设置为只读变量，既不能修改变量的值，也不能删除变量，甚至不能通过+r取消只读属性</span><br><span class="line">x：将变量声明为环境变量</span><br><span class="line">p：显示指定变量的被声明的类型</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">使用<span class="built_in">expr</span>或<span class="built_in">let</span>数值运算$( <span class="built_in">expr</span> 运算式 )</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">( <span class="built_in">expr</span> <span class="variable">$1</span> + <span class="variable">$2</span> )//+-*/ 除法为/*</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">!!使用<span class="built_in">expr</span> +左右必须要有空格</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">$(( 运算式 )) $[ 运算式 ]</span></span><br></pre></td></tr></table></figure><h5 id="通配符"><a href="#通配符" class="headerlink" title="通配符"></a>通配符</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">可以在一个命令中用一个通配符来替代一系列字符或字符串</span></span><br><span class="line">? #匹配任意一个字符</span><br><span class="line">* #匹配0个或任意多个字符</span><br><span class="line">[] #匹配括号内的任意一个字符</span><br><span class="line">[-] #-表示范围 匹配括号内的任意一个字符</span><br><span class="line">[^] #逻辑非 匹配不是括号内的一个字符 例 [^0-9] </span><br></pre></td></tr></table></figure><h5 id="其他特殊符号"><a href="#其他特殊符号" class="headerlink" title="其他特殊符号"></a>其他特殊符号</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x27;&#x27; #单引号内的所有特殊符号如$ ` 都原样输出</span><br><span class="line">&quot;&quot; #双引号内的所有特殊符号都原样输出 除 $ ` \</span><br><span class="line">`` #反引号内的为系统命令和$()一样</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">() <span class="comment">#如上</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">注释</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="comment">#调用变量的值</span></span></span><br><span class="line">\ #转义字符</span><br></pre></td></tr></table></figure><h4 id="脚本编写"><a href="#脚本编写" class="headerlink" title="脚本编写"></a>脚本编写</h4><h5 id="条件判断"><a href="#条件判断" class="headerlink" title="条件判断"></a>条件判断</h5><p>判断的命令和方式</p><p>test 条件表达式</p><p>[ 条件表达式 ]　　注意条件表达式两边有空格</p><p>[[ 条件表达式 ]] 支持正则表达式</p><p><strong>1.文件属性相关判断</strong></p><p>-e 文件(包括目录)是否存在</p><p>-d 是否是目录</p><p>-f 是否是普通文件</p><p>-L 是否是链接文件</p><p>-S 是否是socket文件</p><p>-p 是否是管道文件</p><p>-s 文件大小是否存在并且为非空文件，无法判断非空目录；注意存在且非空才返回true</p><p><strong>2.文件权限相关的判断</strong></p><p>-r 当前用户是否可读</p><p>-w 当前用户是否可写</p><p>-x 当前用户是否可执行</p><p> -u 是否有suid(权限9位的前3位里是否有s位)</p><p>-g 是否sgid(权限9位的中间3位里是否有s位)</p><p>-k 是否有t位(权限9位的后3位里是否有t位)</p><p><strong>3.文件新旧比较</strong></p><p>file1 -nt file2 file1是否比file2新</p><p>file1 -ot file2 file1是否比file2旧</p><p>file -ef file2 file1是否和file2指向同一个inode</p><p><strong>4.数字的比较</strong></p><p>-eq 等于</p><p>-ne 不等于</p><p>-gt 大于</p><p>-lt 小于</p><p>-ge 大于等于</p><p>-le 小于等于</p><p><strong>5.字符串相关的判断</strong></p><p>-z 字符串是否为空</p><p>-n 字符串是否不为空</p><p>str1 &#x3D; str2 是否相等</p><p>str1 !&#x3D; str2 是否不相等</p><p><strong>6..逻辑判断</strong></p><p>-a 且，和 表示连个条件同时满足</p><p>-o 或，两个条件满足一个即可</p><p>！ 取反</p><h5 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h5><h6 id="单分支if"><a href="#单分支if" class="headerlink" title="单分支if"></a>单分支if</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">基本语法</span></span><br><span class="line">if  [  条件表达式 ]</span><br><span class="line">       then   命令1</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">或</span>  </span><br><span class="line">if  [  条件表达式 ] ; then  </span><br><span class="line">        命令1</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p>♦  <strong>if</strong>语句使用<strong>fi</strong>结尾，和一般语言使用大括号结尾不同</p><p>♦ [条件判断式] 使用test命令判断，所以中括号和条件判断式之间<strong>必须有空格</strong></p><p>♦  then后面跟符合条件之后执行的程序，可以放在[ ]之后，用“；”分割。也可以换行写入，就不需要“；”了</p><h6 id="双分支if"><a href="#双分支if" class="headerlink" title="双分支if"></a>双分支if</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if  [  条件表达式 ]</span><br><span class="line">     then   命令1（条件成立时，执行的程序）</span><br><span class="line">     else    命令2（条件不成立时，执行的程序）</span><br><span class="line">fi     </span><br></pre></td></tr></table></figure><h6 id="多分支if"><a href="#多分支if" class="headerlink" title="多分支if"></a>多分支if</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if  [  条件表达式1 ]; then   命令1（条件成立时，执行的程序）</span><br><span class="line">elif  [  条件表达式2 ]; then   命令2（条件成立时，执行的程序）</span><br><span class="line">elif  [  条件表达式3 ]; then   命令3（条件成立时，执行的程序）</span><br><span class="line">…</span><br><span class="line">else 命令n(当所有条件都不成立时，最后执行此程序)</span><br><span class="line">fi      </span><br></pre></td></tr></table></figure><h6 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for 变量名 in 列表</span><br><span class="line">  do</span><br><span class="line">      程序（命令1；命令二等）</span><br><span class="line">  done</span><br></pre></td></tr></table></figure><p>这种语法中for循环的次数，取决于<strong>in****后面值的个数</strong>（空格分隔），有几个值就循环几次，并且每次循环都<strong>把值赋予变量</strong>。假设in后面有三个值，for会循环三次，第一次循环会把值1赋予变量，第二次循环会把值2赋予变量。<strong>当for语句省略后面的in关键字时，将接受</strong>输入命令时的参数**作为循环变量</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for（（初始值；循环控制条件；变量变化））</span><br><span class="line">do</span><br><span class="line">        程序（命令1；命令2等）</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h6 id="while循环"><a href="#while循环" class="headerlink" title="while循环"></a>while循环</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">while  [ 条件判断式 ]   #判断式为真循环</span><br><span class="line">do</span><br><span class="line">      程序</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h6 id="until循环"><a href="#until循环" class="headerlink" title="until循环"></a>until循环</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">until [ 条件判断式 ]   #判断式为假循环</span><br><span class="line">do</span><br><span class="line">     程序</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h6 id="break和continue"><a href="#break和continue" class="headerlink" title="break和continue"></a>break和continue</h6><p>◆Break和continue命令用于中断循环体的顺序执行。</p><p><strong>◆</strong> break命令：将控制转移到done后面的命令，因此循环提前结束。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">格式为： <span class="built_in">break</span> [n]</span><br></pre></td></tr></table></figure><p><strong>◆</strong>  continue命令：将控制转移到done,接着再次计算条件的值，以决定是否继续循环。      </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">格式为：<span class="built_in">continue</span> [n]</span><br></pre></td></tr></table></figure><p><strong>◆</strong>  n: 表示要跳出几层循环，默认值是1，表示只跳出一层循环。</p><h6 id="case语句"><a href="#case语句" class="headerlink" title="case语句"></a>case语句</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">case string1 in</span><br><span class="line">str1)</span><br><span class="line">     commands-list1;;</span><br><span class="line">str2) </span><br><span class="line">     commands-list2;;</span><br><span class="line">...</span><br><span class="line">strn)</span><br><span class="line">     commands-listn;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure><h6 id="函数function"><a href="#函数function" class="headerlink" title="函数function"></a>函数function</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function 函数名 （）&#123;</span><br><span class="line">    程序</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">$函数名 调用</span></span><br></pre></td></tr></table></figure><h3 id="进程管理"><a href="#进程管理" class="headerlink" title="进程管理"></a>进程管理</h3><p><strong>系统进程：</strong>是操作系统启动后，系统环境平台运行所加载的进程，它不与终端或用户关联</p><p><strong>用户进程：</strong>与终端相关联，使用一个用户ID，是由用户所执行的进程</p><p><strong>守护进程：</strong>没有屏幕提示，只是在后台等待请求，网络多用户系统工作绝大多数是通过守护进程实现的</p><h5 id="进程和程序区别"><a href="#进程和程序区别" class="headerlink" title="进程和程序区别"></a><strong>进程和程序区别</strong></h5><p>1）进程是程序在一个数据集合上的运行过程。它是系统进行资源分配和调度的一个<strong>独立单位</strong></p><p>2）程序是永存的；进程是暂时的，是程序在数据集上的一次执行，有创建有撤销，存在是暂时的</p><p>3）程序是<strong>静态</strong>的观念，进程是<strong>动态</strong>的观念</p><p>4）进程具有<strong>并发性</strong>，而程序没有</p><p>5）进程是竞争计算机资源的基本单位，程序不是</p><p>6）进程和程序<strong>不是一一对应</strong>的： 一个程序可对应多个进程即多个进程可执行同一程序； 一个进程可以执行一个或几个程序</p><h5 id="进程管理作用"><a href="#进程管理作用" class="headerlink" title="进程管理作用"></a>进程管理作用</h5><p>   1）判断服务器健康状态</p><p>   2）查看系统中所有进程</p><p>   3）杀死进程</p><h5 id="进程控制命令"><a href="#进程控制命令" class="headerlink" title="进程控制命令"></a>进程控制命令</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">ps [选项]</span><br><span class="line">-a #显示所有用户进程</span><br><span class="line">-f #显示进程详细信息</span><br><span class="line">-e #显示包括系统进程的所有进程</span><br><span class="line">-x #显示没有控制终端的进程</span><br><span class="line">-l #显示进程的详细列表</span><br><span class="line">-u #显示用户名和启动时间等信息</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">常用命令</span></span><br><span class="line">ps -ef    #查看子进程和父进程关系</span><br><span class="line">ps aux   #查看进程状态</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">USER：该进程是由哪个用户产生的</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">PID：进程的ID号</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">%CPU：该进程占用CPU资源的百分比，占用越高，进程越耗费资源</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">%MEM：该进程占用物理内存的百分比，占用越高，进程越耗费资源</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">VSZ：该进程占用虚拟内存的大小，单位.KB</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">RSS ：该进程占用实际物理内存的大小，单位KB</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">TTY ：该进程是在哪个终端中运行的</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">STAT：进程状态</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">START ：该进程的启动时间</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">TIME ：该进程占用CPU的运算时间，注意不是系统时间</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">COMMAND ：产生此进程的命令名</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">C：该进程的CPU使用率</span></span><br></pre></td></tr></table></figure><p><strong>进程状态</strong></p><p>D ：不可被唤醒的睡眠状态</p><p>R ：该进程正在运行</p><p>S ：该进程在睡眠状态，可被唤醒</p><p>T ：停止状态，可能是在后台暂停或进程在除错状态</p><p>Z ：僵尸进程。进程已经终止，但是部分程序还在内存当中</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">top [选项] #实时显示系统的进程状态</span><br><span class="line">-d #秒数：指定top命令每隔几秒更新。默认是3秒</span><br><span class="line">-b ##使用批处理模式输出。一般和“-n”选项合用，用于把 top命令重定向到文件中</span><br><span class="line">-n #次数：指定top命令执行的次数。一般和“-b”选项合用</span><br><span class="line">-p #指定PID，只查看某个PID的进程</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">常用命令</span></span><br><span class="line">top –p 18475                            # 只查看pid为18475的进程</span><br><span class="line">top –b -n 1 &gt; /tmp/top.log     # top命令执行一次，然后把结果保存到top.log文件</span><br></pre></td></tr></table></figure><p><strong>在top命令的交互模式当中可以执行的命令</strong></p><p>?或h：显示交互模式的帮助</p><p>P：以CPU使用时间的多少进行排序，默认就是此项</p><p>M ：以内存的使用率排序</p><p>N ：以PID排序</p><p>T：按照CPU的累积运算时间排序</p><p>K：按照PID号，给予某个进程一个信号</p><p>U：监视指定用户</p><p>q：退出top</p><p><strong>Top命令解释</strong></p><p>   1、任务队列信息</p><p>   2、进程信息</p><p>   3、CPU信息</p><p>  4、物理内存信息</p><p>  5、交换分区（swap）信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pstree [选项] 以树形式显示</span><br><span class="line">-u #显示进程所属用户</span><br><span class="line">-p #显示进程pid</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sleep time ;command #进程延迟一段时间再执行 time为延迟时间。单位为s，command 为命令 </span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kill [选项] pid #杀死进程</span><br><span class="line">-9 #强制杀死</span><br></pre></td></tr></table></figure><h5 id="前后台进程"><a href="#前后台进程" class="headerlink" title="前后台进程"></a>前后台进程</h5><p><strong>◆</strong> 前台是指当前可以操控和执行命令的操作环境，后台是指工作可以自行运行，但是不能直接用ctrl+c来终止它，只能使用<strong>fg&#x2F;bg</strong>来调用工作</p><p>  <strong>◆</strong> 当前的登录终端，只能管理当前终端的工作，而不能管理其他登录终端的工作</p><p>  <strong>◆</strong> 放入后台的命令必须可以持续运行一段时间，这样才能捕捉和操作这个工作</p><p>  <strong>◆</strong> 放入后台执行的命令不能和前台用户有交互或需要前台输入，否则放入后台只能暂停，而不能执行</p><p><strong>命令放入后台方式</strong></p><p>在命令后面加入<strong>“空格</strong>**&amp;**”，这种方法放入后台的命令，在后台是执行状态</p><p>在命令执行过程中按<strong>ctrl+z</strong>快捷键，命令在后台是暂停状态</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jobs [选项] #查看挂起到后台的进程</span><br><span class="line">-l #显示工作的pid</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fg 后台进程编号#后台挂起的命令恢复到前台执行</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bg 后台进程编号#后台挂起的进程恢复到后台执行</span><br></pre></td></tr></table></figure><h5 id="定时任务"><a href="#定时任务" class="headerlink" title="定时任务"></a>定时任务</h5><p><strong>at作业</strong></p><p><strong>◆</strong>  at 一次性执行定时任务</p><p> <strong>◆</strong>  at服务管理：at命令要想正确执行，需要 atd服务的支持。atd服务是独立的服</p><p>   开启服务：service atd start | systemctl start atd</p><p>   设置开机自启：chkconfig atd on | systemctl enable atd</p><p> <strong>◆</strong>  at访问控制：即允许哪些用户使用at命令设定定时任务，或者不允许哪些用户使用at命令，主要依靠**&#x2F;etc&#x2F;at.allow<strong>文件和</strong>&#x2F;etc&#x2F;at.deny**文件来实现</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">at [选项] 时间 #ctrl+d发送</span><br><span class="line">atq #查询当前服务器上的at工作</span><br><span class="line">atrm 工作号 #删除指定的at任务</span><br><span class="line">-m #当at工作完成后，无论命令是否有输出都用email通知执行at命令的用户</span><br><span class="line">-c 工作号#显示该at工作的实际内容</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">时间格式</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">HH:MM</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">HH:MM YYYY-MM-DD</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">HH:MM[am|pm] [month] [<span class="built_in">date</span>]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">HH:MM[am|pm] + [minutes|hours|days|weeks] //+在指定时间再加多久执行</span></span><br></pre></td></tr></table></figure><p><strong>cron作业</strong></p><p>   <strong>◆</strong>  利用多个at命令虽然可以创建多个作业,但它只是指定某一个固定时间去执行,要想实现以固定的间隔时间执行作业,并且能统一管理所有作业, at命令就不能胜任了,可以利用强大的crontab命令来实现 <strong>cron</strong>作业</p><p>  <strong>◆</strong>  cron是一个守护进程,是一个标准的后台服务程序。使用cron作业必须运行<strong>crond</strong> 服务。</p><p>  <strong>◆</strong>  crontab命令和at命令类似，也是通过&#x2F;etc&#x2F;cron. allow和&#x2F;etc&#x2F;cron.deny文件来限制某些用户是否可以使用crontab命令，限制原则类似</p><p><strong>◆  用户的<strong><strong>crontab</strong></strong>设置</strong></p><blockquote><p>每个用户都可以实现自己的crontab定时任务，只要是使用这个用户身份执行“crontab -e”命令即可，这个用户不能加入&#x2F;etc&#x2F;cron.deny文件中。</p></blockquote><p>crontab命令格式如下:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">crontab [选项]</span><br><span class="line">-e #编辑crontab定时任务</span><br><span class="line">-l #查询crontab任务</span><br><span class="line">-r #删除当前用户的所有crontab任务,-e删除一个</span><br><span class="line">-u 用户名 #修改或删除其他用户crntab 仅root可用</span><br></pre></td></tr></table></figure><p> <strong>Crontab定时任务注意事项：</strong></p><p>  1）六个选项都不能为空，必须填写。如果不确定使用“*”代表任意时间;</p><p>  2）crontab定时任务，最小有效时间是分钟，最大时间范围是月。</p><p>  3）在定义时间时，日期和星期最好不要在一条定时任务中出现，因为它们都是以天作为单位，容易让管理员混乱;</p><p>  4）在定时任务中，不管是直接写命令，还是在脚本中写命令，最好都是用绝对路径。有时相对路径的命令会报错</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/crontab</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SHELL=/bin/bash</span><br><span class="line">PATH=/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line">MAILTO=root</span><br><span class="line">HOME=/</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">For details see man 4 crontabs</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Example of job definition:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">.---------------- minute (0 - 59)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">| .------------- hour (0 - 23)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">| | .---------- day of month (1 - 31)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">| | | .------- month (1 - 12) OR jan,feb,mar,apr ...</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">| | | | .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">| | | | |</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">* * * * * user-name <span class="built_in">command</span> to be executed</span></span><br></pre></td></tr></table></figure><p>前四行是用来配置crond任务运行的环境变量，第一行SHELL变量指定了系统要使用哪个shell，这里是bash；第二行PATH变量指定了系统执行[命令]的路径；第三行MAILTO变量指定了crond的任务执行信息将通过电子邮件发送给root用户，如果MAILTO变量的值为空，则表示不发送任务执行信息给用户；第四行的HOME变量指定了在执行命令或者[脚本]时使用的主目录。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
